<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàêÈïøÂä®ÊÄÅ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .user-name-section {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .user-name-input {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            min-width: 200px;
        }

        .update-name-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .update-name-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            transition: opacity 0.3s ease;
            line-height: 1.2;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }

        .header h1 #userNameDisplay {
            display: inline;
        }

        .header h1:hover {
            opacity: 0.8;
        }

        .header h1:hover::after {
            content: " (ÁÇπÂáª‰øÆÊîπÂßìÂêç)";
            font-size: 0.4em;
            opacity: 0.7;
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 10px;
            white-space: nowrap;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            text-align: center;
            margin: 0 auto;
            max-width: 100%;
        }

        .main-content {
            display: flex;
            min-height: 600px;
        }

        .sidebar {
            width: 300px;
            background: #f8f9fa;
            padding: 30px 20px;
            border-right: 1px solid #e9ecef;
        }

        .content-area {
            flex: 1;
            padding: 30px;
        }

        .nav-item {
            display: block;
            width: 100%;
            padding: 15px 20px;
            margin-bottom: 10px;
            background: white;
            border: none;
            border-radius: 10px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            color: #495057;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .nav-item:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .nav-item.active {
            background: #667eea;
            color: white;
        }

        .module {
            display: none;
        }

        .module.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .module h2 {
            color: #495057;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .rating-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .rating-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #e9ecef;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .rating-btn:hover {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .rating-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .emotion-btn {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .emotion-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .emotion-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .dashboard-preview {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #dee2e6;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .data-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }

        .summary-card h3 {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .summary-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #495057;
        }

        .reading-quotes {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 10px 10px 0;
        }

        .quote-item {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .quote-text {
            font-style: italic;
            color: #495057;
            margin-bottom: 5px;
        }

        .quote-reflection {
            font-size: 0.9em;
            color: #6c757d;
        }

        .export-section {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .export-buttons-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            max-width: 600px;
            margin: 0 auto;
        }

        .export-btn {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.2);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.4);
            background: linear-gradient(135deg, #5f3dc4 0%, #9775fa 100%);
        }

        /* Â≠¶‰π†‰∏ªÈ¢òÊ†áÁ≠æÊ†∑Âºè */
        .study-topics-container {
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            border-radius: 15px;
            border: 2px solid #e8ecff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .topic-input-wrapper {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
            align-items: center;
        }

        .topic-input-wrapper input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .topic-input-wrapper input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }

        .add-topic-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .add-topic-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

        .add-topic-btn:disabled {
            background: linear-gradient(135deg, #ccc 0%, #bbb 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .topic-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            min-height: 50px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            border: 2px solid #f0f0f0;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 18px;
        }

        .topic-tag {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            gap: 8px;
            animation: slideIn 0.3s ease;
        }

        .topic-tag .topic-name {
            font-weight: 500;
        }

        .topic-tag .topic-time-input {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .topic-tag .topic-time-input input {
            background: transparent;
            border: none;
            color: white;
            width: 40px;
            font-size: 12px;
            text-align: center;
            padding: 0;
        }

        .topic-tag .topic-time-input input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .topic-tag .topic-time-input input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .topic-tag .topic-time-input .time-unit {
            font-size: 11px;
            opacity: 0.9;
        }

        .topic-tag .remove-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s ease;
        }

        .topic-tag .remove-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .duration-wrapper {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 18px;
        }

        .duration-wrapper label {
            font-weight: 600;
            color: #333;
            min-width: 140px;
            font-size: 14px;
        }

        .duration-wrapper input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .duration-wrapper input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }

        .distribute-time-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
        }

        .distribute-time-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .time-status {
            margin-top: 12px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
            border-radius: 10px;
            font-size: 14px;
            color: #1976d2;
            border-left: 4px solid #2196f3;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* ÂõæÁâá‰∏ä‰º†Ê†∑Âºè */
        .image-upload-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            border: 2px dashed #667eea;
        }

        .image-upload-label {
            display: block;
            text-align: center;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 10px;
        }

        .image-upload-label:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .image-upload-input {
            display: none;
        }

        .image-preview {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .image-item {
            position: relative;
            width: 100px;
            height: 120px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .image-item:hover {
            transform: scale(1.05);
        }

        .image-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
        }

        .image-description-preview {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px;
            font-size: 10px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .image-remove {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-remove:hover {
            background: rgba(255, 0, 0, 1);
        }

        /* ‰ªäÊó•ËÆ∞ÂΩïÊ†∑Âºè */
        .today-records-section {
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border-radius: 15px;
            border: 1px solid #e0e8ff;
        }

        .today-records-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .today-records-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .record-category {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
        }

        .record-category h4 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .record-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .record-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 3px solid #28a745;
            font-size: 14px;
            line-height: 1.4;
        }

        .record-item:last-child {
            margin-bottom: 0;
        }

        .record-time {
            color: #6c757d;
            font-size: 12px;
            margin-top: 5px;
        }

        .no-records {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        /* Ê®°ÂùóÂØºÂá∫ÊåâÈíÆÊ†∑Âºè */
        .module-export-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .module-export-section h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 14px;
        }

        .export-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
        }

        .export-btn {
            padding: 8px 12px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            text-align: center;
        }

        .export-btn:hover {
            background: #007bff;
            color: white;
        }

        /* Êó∂Èó¥ËåÉÂõ¥ÈÄâÊã©Âô®Ê†∑Âºè */
        .time-range-selector {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .time-range-selector label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
            font-size: 14px;
        }

        .time-range-selector select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            color: #495057;
        }

        .time-range-selector select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        /* ÊâãÊú∫Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            .today-records-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .record-category {
                padding: 15px;
            }
            
            .export-buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .export-btn {
                font-size: 11px;
                padding: 6px 8px;
            }
        }
            body {
                padding: 10px;
            }

            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                padding: 20px 15px;
                display: flex;
                overflow-x: auto;
                gap: 10px;
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }

            .nav-item {
                min-width: 120px;
                margin-bottom: 0;
                text-align: center;
                font-size: 14px;
                padding: 12px 15px;
            }
            
            .container {
                margin: 0;
                border-radius: 15px;
            }

            .content-area {
                padding: 20px 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 2em;
            }

            .form-control {
                font-size: 16px; /* Èò≤Ê≠¢iOSÁº©Êîæ */
            }

            .rating-group {
                flex-wrap: wrap;
                gap: 8px;
            }

            .rating-btn {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }

            .emotion-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .emotion-btn {
                padding: 12px 8px;
                font-size: 12px;
            }

            .data-summary {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .summary-card {
                padding: 15px;
            }

            .summary-card h3 {
                font-size: 1em;
            }

            .summary-card .value {
                font-size: 1.5em;
            }

            .chart-container {
                height: 250px;
            }

            .export-btn {
                padding: 12px 20px;
                font-size: 14px;
                margin: 5px;
                display: block;
                width: 100%;
            }

            .image-item {
                width: 80px;
                height: 80px;
            }

            .image-upload-label {
                padding: 15px;
                font-size: 14px;
            }
        }

        /* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
        @media (max-width: 480px) {
            .sidebar {
                padding: 15px 10px;
            }

            .nav-item {
                min-width: 100px;
                font-size: 12px;
                padding: 10px 12px;
            }

            .content-area {
                padding: 15px 10px;
            }

            .data-summary {
                grid-template-columns: 1fr;
            }

            .rating-group {
                justify-content: center;
            }

            .emotion-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ÂõæÁâáÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.8);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal.show .modal-content {
            transform: scale(1);
        }

        .image-modal-content {
            max-width: 900px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #f0f0f0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: white;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 25px;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .image-detail-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            align-items: start;
        }

        .image-display {
            text-align: center;
        }

        .image-display img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .image-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-group textarea,
        .form-group input[type="text"] {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            resize: vertical;
        }

        .form-group textarea:focus,
        .form-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .timestamp {
            color: #6c757d;
            font-size: 14px;
            padding: 8px 0;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 20px 25px;
            border-top: 1px solid #f0f0f0;
            background: #f8f9fa;
        }

        .btn-primary,
        .btn-secondary {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
         @media (max-width: 768px) {
             .image-detail-container {
                 grid-template-columns: 1fr;
                 gap: 20px;
             }

             .modal-content {
                 width: 95%;
                 margin: 10px;
             }

             .modal-header,
             .modal-body,
             .modal-footer {
                 padding: 15px 20px;
             }
         }

         /* Êó∂Èó¥ËΩ¥Ê†∑Âºè */
         .timeline-controls {
             background: white;
             padding: 25px;
             border-radius: 15px;
             box-shadow: 0 3px 10px rgba(0,0,0,0.08);
             margin-bottom: 25px;
         }

         .timeline-filters {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 20px;
             margin-bottom: 20px;
         }

         .filter-group {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }

         .filter-group label {
             font-weight: 600;
             color: #495057;
             font-size: 14px;
         }

         .timeline-stats {
             display: flex;
             gap: 30px;
             padding-top: 20px;
             border-top: 1px solid #e9ecef;
         }

         .stat-item {
             display: flex;
             align-items: center;
             gap: 8px;
         }

         .stat-label {
             color: #6c757d;
             font-size: 14px;
         }

         .stat-value {
             font-weight: 600;
             color: #667eea;
             font-size: 16px;
         }

         .timeline-container {
             background: white;
             border-radius: 15px;
             box-shadow: 0 3px 10px rgba(0,0,0,0.08);
             overflow: hidden;
         }

         .timeline-content {
             padding: 25px;
         }

         .timeline-empty {
             text-align: center;
             padding: 60px 20px;
             color: #6c757d;
         }

         .empty-icon {
             font-size: 4em;
             margin-bottom: 20px;
             opacity: 0.5;
         }

         .timeline-empty h3 {
             margin-bottom: 10px;
             color: #495057;
         }

         .timeline-item {
             display: flex;
             margin-bottom: 30px;
             position: relative;
         }

         .timeline-item:last-child {
             margin-bottom: 0;
         }

         .timeline-item::before {
             content: '';
             position: absolute;
             left: 20px;
             top: 50px;
             bottom: -30px;
             width: 2px;
             background: linear-gradient(to bottom, #667eea, #764ba2);
         }

         .timeline-item:last-child::before {
             display: none;
         }

         .timeline-date {
             flex-shrink: 0;
             width: 120px;
             text-align: center;
             padding: 15px 10px;
         }

         .timeline-date-circle {
             width: 40px;
             height: 40px;
             border-radius: 50%;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             color: white;
             display: flex;
             align-items: center;
             justify-content: center;
             font-weight: 600;
             font-size: 14px;
             margin: 0 auto 10px;
             box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
         }

         .timeline-date-text {
             font-size: 12px;
             color: #6c757d;
             font-weight: 500;
         }

         .timeline-content-wrapper {
             flex: 1;
             margin-left: 30px;
         }

         .timeline-images {
             display: grid;
             grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
             gap: 15px;
         }

         .timeline-image-item {
             position: relative;
             border-radius: 10px;
             overflow: hidden;
             box-shadow: 0 3px 10px rgba(0,0,0,0.1);
             transition: transform 0.3s ease;
             cursor: pointer;
         }

         .timeline-image-item:hover {
             transform: translateY(-3px);
             box-shadow: 0 6px 20px rgba(0,0,0,0.15);
         }

         .timeline-image-item img {
             width: 100%;
             height: 120px;
             object-fit: cover;
         }

         .timeline-image-overlay {
             position: absolute;
             bottom: 0;
             left: 0;
             right: 0;
             background: linear-gradient(transparent, rgba(0,0,0,0.7));
             color: white;
             padding: 10px 8px 8px;
             font-size: 12px;
         }

         .timeline-image-module {
             font-weight: 600;
             margin-bottom: 2px;
         }

         .timeline-image-desc {
             opacity: 0.9;
             line-height: 1.3;
             display: -webkit-box;
             -webkit-line-clamp: 2;
             -webkit-box-orient: vertical;
             overflow: hidden;
         }

         .timeline-image-tags {
             margin-top: 5px;
         }

         .timeline-tag {
             display: inline-block;
             background: rgba(255,255,255,0.2);
             padding: 2px 6px;
             border-radius: 10px;
             font-size: 10px;
             margin-right: 4px;
         }

         /* Êó∂Èó¥ËΩ¥ÂìçÂ∫îÂºèËÆæËÆ° */
         @media (max-width: 768px) {
             .timeline-filters {
                 grid-template-columns: 1fr;
                 gap: 15px;
             }

             .timeline-stats {
                 flex-direction: column;
                 gap: 10px;
             }

             .timeline-item {
                 flex-direction: column;
                 margin-bottom: 25px;
             }

             .timeline-item::before {
                 display: none;
             }

             .timeline-date {
                 width: 100%;
                 margin-bottom: 15px;
             }

             .timeline-content-wrapper {
                 margin-left: 0;
             }

             .timeline-images {
                 grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                 gap: 10px;
             }

             .timeline-image-item img {
                 height: 100px;
             }
         }

         /* Ê†áÁ≠æÁ≥ªÁªüÊ†∑Âºè */
         .tag-input-container {
             position: relative;
         }

         .tag-suggestions {
             position: absolute;
             top: 100%;
             left: 0;
             right: 0;
             background: white;
             border: 1px solid #ddd;
             border-radius: 4px;
             max-height: 150px;
             overflow-y: auto;
             z-index: 1000;
             display: none;
         }

         .tag-suggestion-item {
             padding: 8px 12px;
             cursor: pointer;
             border-bottom: 1px solid #f0f0f0;
         }

         .tag-suggestion-item:hover {
             background-color: #f5f5f5;
         }

         .tag-suggestion-item:last-child {
             border-bottom: none;
         }

         .current-tags {
             margin-top: 10px;
             display: flex;
             flex-wrap: wrap;
             gap: 6px;
         }

         .tag-item {
             display: inline-flex;
             align-items: center;
             background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
             color: white;
             padding: 4px 8px;
             border-radius: 12px;
             font-size: 12px;
             gap: 4px;
         }

         .tag-remove {
             cursor: pointer;
             font-weight: bold;
             opacity: 0.8;
         }

         .tag-remove:hover {
             opacity: 1;
         }

         .popular-tags {
             margin-top: 10px;
         }

         .popular-tags-label {
             font-size: 12px;
             color: #666;
             margin-bottom: 5px;
             display: block;
         }

         .popular-tags-list {
             display: flex;
             flex-wrap: wrap;
             gap: 4px;
         }

         .popular-tag {
             background: #f0f0f0;
             color: #333;
             padding: 3px 8px;
             border-radius: 10px;
             font-size: 11px;
             cursor: pointer;
             border: 1px solid transparent;
             transition: all 0.2s;
         }

         .popular-tag:hover {
             background: #e0e0e0;
             border-color: #ccc;
         }

         .timeline-tag {
             background: rgba(255, 255, 255, 0.9);
             color: #333;
             padding: 2px 6px;
             border-radius: 8px;
             font-size: 10px;
             margin-right: 4px;
         }

         /* Ê†áÁ≠æÁÆ°ÁêÜÈù¢ÊùøÊ†∑Âºè */
         .tag-management-panel {
             background: white;
             border-radius: 8px;
             padding: 20px;
             margin-bottom: 20px;
             box-shadow: 0 2px 10px rgba(0,0,0,0.1);
         }

         .tag-stats {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
             gap: 15px;
             margin-bottom: 20px;
         }

         .tag-stat-item {
             text-align: center;
             padding: 15px;
             background: white;
             color: #333;
             border-radius: 8px;
             border: 1px solid #e9ecef;
         }

         .tag-stat-number {
             font-size: 24px;
             font-weight: bold;
             display: block;
         }

         .tag-stat-label {
             font-size: 12px;
             opacity: 0.9;
         }

         .tag-cloud {
             display: flex;
             flex-wrap: wrap;
             gap: 8px;
             align-items: center;
         }

         .tag-cloud-item {
             background: #F5DEB3;
             color: #8B4513;
             padding: 6px 12px;
             border-radius: 15px;
             font-size: 13px;
             cursor: pointer;
             transition: all 0.3s;
             position: relative;
         }

         .tag-cloud-item:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 12px rgba(0,0,0,0.2);
         }

         .tag-cloud-item .tag-count {
             background: rgba(139,69,19,0.2);
             padding: 2px 6px;
             border-radius: 8px;
             font-size: 10px;
             margin-left: 6px;
         }

         /* ÂõæÁâáÁªüËÆ°Èù¢ÊùøÊ†∑Âºè */
         .image-stats {
             background: white;
             color: #333;
             border: 1px solid #e9ecef;
         }

         .image-growth-panel {
             background: white;
             border-radius: 12px;
             padding: 25px;
             margin: 20px 0;
             box-shadow: 0 4px 20px rgba(0,0,0,0.1);
         }

         .image-growth-panel h3 {
             color: #333;
             margin-bottom: 20px;
             font-size: 18px;
             display: flex;
             align-items: center;
             gap: 8px;
         }

         .image-stats-grid {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 20px;
         }

         .image-stat-card {
             background: #f8f9fa;
             border-radius: 8px;
             padding: 20px;
             border-left: 4px solid #667eea;
         }

         .image-stat-card h4 {
             color: #333;
             margin-bottom: 15px;
             font-size: 14px;
             font-weight: 600;
         }

         .module-distribution {
             display: flex;
             flex-direction: column;
             gap: 8px;
         }

         .module-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 8px 12px;
             background: white;
             border-radius: 6px;
             border-left: 3px solid #667eea;
         }

         .module-name {
             font-size: 13px;
             color: #555;
         }

         .module-count {
             font-weight: bold;
             color: #667eea;
         }

         .monthly-trend {
             display: flex;
             flex-direction: column;
             gap: 6px;
         }

         .trend-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 6px 10px;
             background: white;
             border-radius: 4px;
             font-size: 12px;
         }

         .trend-month {
             color: #666;
         }

         .trend-count {
             font-weight: bold;
             color: #28a745;
         }

         .top-tags-list {
             display: flex;
             flex-direction: column;
             gap: 6px;
         }

         .top-tag-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 8px 12px;
             background: white;
             border-radius: 6px;
             cursor: pointer;
             transition: all 0.2s;
         }

         .top-tag-item:hover {
             background: #e9ecef;
             transform: translateX(2px);
         }

         .tag-name {
             font-size: 13px;
             color: #555;
         }

         .tag-usage-count {
             background: #667eea;
             color: white;
             padding: 2px 8px;
             border-radius: 10px;
             font-size: 11px;
             font-weight: bold;
         }

         .time-distribution {
             display: grid;
             grid-template-columns: repeat(4, 1fr);
             gap: 8px;
         }

         .time-slot {
             text-align: center;
             padding: 10px 5px;
             background: white;
             border-radius: 6px;
             font-size: 11px;
         }

         .time-label {
             color: #666;
             margin-bottom: 4px;
         }

         .time-count {
             font-weight: bold;
             color: #667eea;
             font-size: 14px;
         }

         @media (max-width: 768px) {
             .image-stats-grid {
                 grid-template-columns: 1fr;
             }
             
             .time-distribution {
                 grid-template-columns: repeat(2, 1fr);
             }
         }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-name-section" id="userNameSection" style="display: none;">
                <input type="text" id="userName" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂßìÂêç" class="user-name-input">
                <button onclick="updateUserName()" class="update-name-btn">Á°ÆËÆ§</button>
            </div>
            <h1 id="mainTitle" onclick="toggleUserNameSection()" style="cursor: pointer;">
                üå± <span id="userNameDisplay">ÊÇ®ÁöÑ</span>ÊàêÈïøÂä®ÊÄÅ
            </h1>
            <p id="dailyQuote">ËÆ∞ÂΩïÊØè‰∏ÄÂ§©ÁöÑÊàêÈïøËΩ®ËøπÔºåËÆ©ËøõÊ≠•ÁúãÂæóËßÅ</p>
        </div>
        
        <div class="main-content">
            <div class="sidebar">
                <button class="nav-item" onclick="showModule('plan')">üìÖ ÊòéÊó•ËÆ°Âàí</button>
                <button class="nav-item" onclick="showModule('exercise')">üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®ËÆ∞ÂΩï</button>
                <button class="nav-item" onclick="showModule('study')">üìö Â≠¶‰π†ÂÜÖÂÆπ</button>
                <button class="nav-item" onclick="showModule('reading')">üìñ ÈòÖËØªÊÑüÊÇü</button>
                <button class="nav-item" onclick="showModule('emotion')">üòä ÊÉÖÁª™Áä∂ÊÄÅ</button>
                <button class="nav-item" onclick="showModule('timeline')">üì∏ ÂõæÁâáÊó∂Èó¥ËΩ¥</button>
                <button class="nav-item" onclick="showModule('dashboard')">üìä Êï∞ÊçÆÈù¢Êùø</button>
            </div>
            
            <div class="content-area">
                <!-- ËÆ°ÂàíÊ®°Âùó -->
                <div id="plan" class="module active">
                    <h2>üìÖ ÊòéÊó•ËÆ°Âàí</h2>
                    <div class="form-group">
                        <label>Êó•Êúü</label>
                        <input type="date" id="planDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>‰∏ªË¶ÅÁõÆÊ†á (1-3‰∏™)</label>
                        <textarea id="mainGoals" class="form-control" placeholder="‰æãÂ¶ÇÔºöÂÆåÊàêÈ°πÁõÆÊä•Âëä„ÄÅÈîªÁÇº30ÂàÜÈíü„ÄÅÈòÖËØª20È°µ"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ÂÖ∑‰ΩìÂÆâÊéí</label>
                        <textarea id="detailPlan" class="form-control" placeholder="ËØ¶ÁªÜÁöÑÊó∂Èó¥ÂÆâÊéíÂíåÂÖ∑‰Ωì‰ªªÂä°"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ÊúüÊúõÂÆåÊàêÂ∫¶</label>
                        <div class="rating-group">
                            <span>ÁõÆÊ†áÂÆåÊàêÂ∫¶Ôºö</span>
                            <div id="planRating">
                                <button class="rating-btn" onclick="setRating('plan', 1)">1</button>
                                <button class="rating-btn" onclick="setRating('plan', 2)">2</button>
                                <button class="rating-btn" onclick="setRating('plan', 3)">3</button>
                                <button class="rating-btn" onclick="setRating('plan', 4)">4</button>
                                <button class="rating-btn" onclick="setRating('plan', 5)">5</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
                    <div class="image-upload-section">
                        <label for="plan-image" class="image-upload-label">
                            üì∑ ÁÇπÂáª‰∏ä‰º†Áõ∏ÂÖ≥ÂõæÁâá
                        </label>
                        <input type="file" id="plan-image" class="image-upload-input" accept="image/*" multiple>
                        <div id="plan-image-preview" class="image-preview"></div>
                    </div>
                    
                    <button class="btn-primary" onclick="savePlanData()">‰øùÂ≠òËÆ°Âàí</button>
                    
                    <!-- ÂØºÂá∫ÊåâÈíÆ -->
                    <div class="module-export-section">
                        <h4>üì§ ÂØºÂá∫ËÆ°Âàí</h4>
                        <div class="time-range-selector">
                            <label>Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="planTimeRange" class="form-control">
                                <option value="1">ÊúÄËøë1Â§©</option>
                                <option value="7">ÊúÄËøë1Âë®</option>
                                <option value="30">ÊúÄËøë1‰∏™Êúà</option>
                                <option value="90">ÊúÄËøë3‰∏™Êúà</option>
                                <option value="180">ÊúÄËøë6‰∏™Êúà</option>
                                <option value="365">ÊúÄËøë1Âπ¥</option>
                                <option value="all" selected>ÊâÄÊúâÊó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportModuleData('plan', 'smart')">üìù Êô∫ËÉΩÊï¥ÁêÜ</button>
                            <button class="export-btn" onclick="exportModuleData('plan', 'json')">üìÑ JSONÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('plan', 'csv')">üìä CSVÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('plan', 'txt')">üìù ÊñáÊú¨Ê†ºÂºè</button>
                        </div>
                    </div>
                </div>

                <!-- ËøêÂä®Ê®°Âùó -->
                <div id="exercise" class="module">
                    <h2>üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®ËÆ∞ÂΩï</h2>
                    <div class="form-group">
                        <label>ËøêÂä®Á±ªÂûã</label>
                        <select id="exerciseTypeSelect" class="form-control" onchange="handleExerciseTypeChange()">
                            <option value="">ËØ∑ÈÄâÊã©ËøêÂä®Á±ªÂûã</option>
                            <option value="Ë∑ëÊ≠•">üèÉ‚Äç‚ôÇÔ∏è Ë∑ëÊ≠•</option>
                            <option value="ÂÅ•Ë∫´Êàø">üí™ ÂÅ•Ë∫´Êàø</option>
                            <option value="Áëú‰ºΩ">üßò‚Äç‚ôÄÔ∏è Áëú‰ºΩ</option>
                            <option value="Ê∏∏Ê≥≥">üèä‚Äç‚ôÇÔ∏è Ê∏∏Ê≥≥</option>
                            <option value="È™ëË°å">üö¥‚Äç‚ôÇÔ∏è È™ëË°å</option>
                            <option value="ÁØÆÁêÉ">üèÄ ÁØÆÁêÉ</option>
                            <option value="Ë∂≥ÁêÉ">‚öΩ Ë∂≥ÁêÉ</option>
                            <option value="ÁæΩÊØõÁêÉ">üè∏ ÁæΩÊØõÁêÉ</option>
                            <option value="‰πí‰πìÁêÉ">üèì ‰πí‰πìÁêÉ</option>
                            <option value="ÁΩëÁêÉ">üéæ ÁΩëÁêÉ</option>
                            <option value="Áà¨Â±±">üèîÔ∏è Áà¨Â±±</option>
                            <option value="Êï£Ê≠•">üö∂‚Äç‚ôÇÔ∏è Êï£Ê≠•</option>
                            <option value="ËàûËπà">üíÉ ËàûËπà</option>
                            <option value="ÊôÆÊãâÊèê">ü§∏‚Äç‚ôÄÔ∏è ÊôÆÊãâÊèê</option>
                            <option value="ÂÖ∂‰ªñ">‚úèÔ∏è ÂÖ∂‰ªñÔºàËá™ÂÆö‰πâÔºâ</option>
                        </select>
                        <input type="text" id="exerciseType" class="form-control" placeholder="ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâËøêÂä®Á±ªÂûã" style="display: none; margin-top: 10px;">
                    </div>
                    <div class="form-group">
                        <label>ËøêÂä®Êó∂Èïø (ÂàÜÈíü)</label>
                        <input type="number" id="exerciseDuration" class="form-control" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label>ËøêÂä®Âº∫Â∫¶</label>
                        <div class="rating-group">
                            <span>Âº∫Â∫¶ËØÑÂàÜÔºö</span>
                            <div id="exerciseIntensity">
                                <button class="rating-btn" onclick="setRating('exerciseIntensity', 1)">1</button>
                                <button class="rating-btn" onclick="setRating('exerciseIntensity', 2)">2</button>
                                <button class="rating-btn" onclick="setRating('exerciseIntensity', 3)">3</button>
                                <button class="rating-btn" onclick="setRating('exerciseIntensity', 4)">4</button>
                                <button class="rating-btn" onclick="setRating('exerciseIntensity', 5)">5</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ËøêÂä®ÊÑüÂèó</label>
                        <textarea id="exerciseFeeling" class="form-control" placeholder="ËøêÂä®ÂêéÁöÑÊÑüÂèóÂíå‰ΩìÈ™å"></textarea>
                    </div>

                    <!-- ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
                    <div class="image-upload-section">
                        <label for="exercise-image" class="image-upload-label">
                            üì∑ ÁÇπÂáª‰∏ä‰º†ËøêÂä®ÂõæÁâá
                        </label>
                        <input type="file" id="exercise-image" class="image-upload-input" accept="image/*" multiple>
                        <div id="exercise-image-preview" class="image-preview"></div>
                    </div>

                    <button class="btn-primary" onclick="saveExerciseData()">‰øùÂ≠òËøêÂä®ËÆ∞ÂΩï</button>
                    
                    <!-- ÂØºÂá∫ÊåâÈíÆ -->
                    <div class="module-export-section">
                        <h4>üì§ ÂØºÂá∫ËøêÂä®ËÆ∞ÂΩï</h4>
                        <div class="time-range-selector">
                            <label>Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="exerciseTimeRange" class="form-control">
                                <option value="1">ÊúÄËøë1Â§©</option>
                                <option value="7">ÊúÄËøë1Âë®</option>
                                <option value="30">ÊúÄËøë1‰∏™Êúà</option>
                                <option value="90">ÊúÄËøë3‰∏™Êúà</option>
                                <option value="180">ÊúÄËøë6‰∏™Êúà</option>
                                <option value="365">ÊúÄËøë1Âπ¥</option>
                                <option value="all" selected>ÊâÄÊúâÊó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportModuleData('exercise', 'smart')">üìù Êô∫ËÉΩÊï¥ÁêÜ</button>
                            <button class="export-btn" onclick="exportModuleData('exercise', 'json')">üìÑ JSONÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('exercise', 'csv')">üìä CSVÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('exercise', 'txt')">üìù ÊñáÊú¨Ê†ºÂºè</button>
                        </div>
                    </div>
                </div>

                <!-- Â≠¶‰π†Ê®°Âùó -->
                <div id="study" class="module">
                    <h2>üìö Â≠¶‰π†ÂÜÖÂÆπ</h2>
                    <div class="form-group">
                        <label>Â≠¶‰π†‰∏ªÈ¢ò</label>
                        <div class="study-topics-container">
                            <div class="topic-input-wrapper">
                                <input type="text" id="newStudyTopic" class="form-control" placeholder="ËæìÂÖ•Â≠¶‰π†‰∏ªÈ¢òÔºåÂ¶ÇÔºöJavaScript">
                                <button type="button" class="add-topic-btn" onclick="addStudyTopic()">Ê∑ªÂä†</button>
                            </div>
                            <div id="studyTopicTags" class="topic-tags-container"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ÊÄªÂ≠¶‰π†Êó∂ÈïøÊ±áÊÄª</label>
                        <div class="duration-summary">
                            <div id="totalStudyTime" class="time-display">
                                <span class="time-minutes">0ÂàÜÈíü</span>
                                <span class="time-hours">(0Â∞èÊó∂)</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Â≠¶‰π†ÂÜÖÂÆπ</label>
                        <textarea id="studyContent" class="form-control" placeholder="‰ªäÂ§©Â≠¶‰π†ÁöÑÂÖ∑‰ΩìÂÜÖÂÆπ"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ÊéåÊè°Á®ãÂ∫¶</label>
                        <div class="rating-group">
                            <span>ÊéåÊè°ËØÑÂàÜÔºö</span>
                            <div id="studyMastery">
                                <button class="rating-btn" onclick="setRating('studyMastery', 1)">1</button>
                                <button class="rating-btn" onclick="setRating('studyMastery', 2)">2</button>
                                <button class="rating-btn" onclick="setRating('studyMastery', 3)">3</button>
                                <button class="rating-btn" onclick="setRating('studyMastery', 4)">4</button>
                                <button class="rating-btn" onclick="setRating('studyMastery', 5)">5</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Â≠¶‰π†Êî∂Ëé∑</label>
                        <textarea id="studyGains" class="form-control" placeholder="‰ªäÂ§©ÁöÑÂ≠¶‰π†Êî∂Ëé∑ÂíåÂøÉÂæó"></textarea>
                    </div>

                    <!-- ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
                    <div class="image-upload-section">
                        <label for="study-image" class="image-upload-label">
                            üì∑ ÁÇπÂáª‰∏ä‰º†Â≠¶‰π†ÂõæÁâá
                        </label>
                        <input type="file" id="study-image" class="image-upload-input" accept="image/*" multiple>
                        <div id="study-image-preview" class="image-preview"></div>
                    </div>

                    <button class="btn-primary" onclick="saveStudyData()">‰øùÂ≠òÂ≠¶‰π†ËÆ∞ÂΩï</button>
                    
                    <!-- ÂØºÂá∫ÊåâÈíÆ -->
                    <div class="module-export-section">
                        <h4>üì§ ÂØºÂá∫Â≠¶‰π†ËÆ∞ÂΩï</h4>
                        <div class="time-range-selector">
                            <label>Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="studyTimeRange" class="form-control">
                                <option value="1">ÊúÄËøë1Â§©</option>
                                <option value="7">ÊúÄËøë1Âë®</option>
                                <option value="30">ÊúÄËøë1‰∏™Êúà</option>
                                <option value="90">ÊúÄËøë3‰∏™Êúà</option>
                                <option value="180">ÊúÄËøë6‰∏™Êúà</option>
                                <option value="365">ÊúÄËøë1Âπ¥</option>
                                <option value="all" selected>ÊâÄÊúâÊó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportModuleData('study', 'smart')">üìù Êô∫ËÉΩÊï¥ÁêÜ</button>
                            <button class="export-btn" onclick="exportModuleData('study', 'json')">üìÑ JSONÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('study', 'csv')">üìä CSVÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('study', 'txt')">üìù ÊñáÊú¨Ê†ºÂºè</button>
                        </div>
                    </div>
                </div>

                <!-- ÈòÖËØªÊ®°Âùó -->
                <div id="reading" class="module">
                    <h2>üìñ ÈòÖËØªÊÑüÊÇü</h2>
                    <div class="form-group">
                        <label>‰π¶Á±ç/ÊñáÁ´†ÂêçÁß∞</label>
                        <input type="text" id="readingTitle" class="form-control" placeholder="‰ªäÂ§©ÈòÖËØªÁöÑ‰π¶Á±çÊàñÊñáÁ´†">
                    </div>
                    <div class="form-group">
                        <label>ÈòÖËØªÈ°µÊï∞/Êó∂Èïø</label>
                        <input type="text" id="readingProgress" class="form-control" placeholder="‰æãÂ¶ÇÔºö20È°µ Êàñ 30ÂàÜÈíü">
                    </div>
                    <div class="form-group">
                        <label>ÊëòÂΩïÂè•Â≠ê</label>
                        <textarea id="readingQuotes" class="form-control" placeholder="ÊëòÂΩïÂç∞Ë±°Ê∑±ÂàªÁöÑÂè•Â≠êÊàñÊÆµËêΩ"></textarea>
                        <button type="button" class="btn-primary" onclick="addQuote()">Ê∑ªÂä†ÊëòÂΩï</button>
                    </div>
                    <div id="quotesContainer" class="reading-quotes"></div>
                    <div class="form-group">
                        <label>ÈòÖËØªÊÑüÊÇü</label>
                        <textarea id="readingReflection" class="form-control" placeholder="‰ªäÂ§©ÈòÖËØªÁöÑÊÑüÊÇüÂíåÊÄùËÄÉ"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Êé®ËçêÊåáÊï∞</label>
                        <div class="rating-group">
                            <span>Êé®ËçêËØÑÂàÜÔºö</span>
                            <div id="readingRating">
                                <button class="rating-btn" onclick="setRating('readingRating', 1)">1</button>
                                <button class="rating-btn" onclick="setRating('readingRating', 2)">2</button>
                                <button class="rating-btn" onclick="setRating('readingRating', 3)">3</button>
                                <button class="rating-btn" onclick="setRating('readingRating', 4)">4</button>
                                <button class="rating-btn" onclick="setRating('readingRating', 5)">5</button>
                            </div>
                        </div>
                    </div>

                    <!-- ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
                    <div class="image-upload-section">
                        <label for="reading-image" class="image-upload-label">
                            üì∑ ÁÇπÂáª‰∏ä‰º†ÈòÖËØªÂõæÁâá
                        </label>
                        <input type="file" id="reading-image" class="image-upload-input" accept="image/*" multiple>
                        <div id="reading-image-preview" class="image-preview"></div>
                    </div>

                    <button class="btn-primary" onclick="saveReadingData()">‰øùÂ≠òÈòÖËØªËÆ∞ÂΩï</button>
                    
                    <!-- ÂØºÂá∫ÊåâÈíÆ -->
                    <div class="module-export-section">
                        <h4>üì§ ÂØºÂá∫ÈòÖËØªËÆ∞ÂΩï</h4>
                        <div class="time-range-selector">
                            <label>Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="readingTimeRange" class="form-control">
                                <option value="1">ÊúÄËøë1Â§©</option>
                                <option value="7">ÊúÄËøë1Âë®</option>
                                <option value="30">ÊúÄËøë1‰∏™Êúà</option>
                                <option value="90">ÊúÄËøë3‰∏™Êúà</option>
                                <option value="180">ÊúÄËøë6‰∏™Êúà</option>
                                <option value="365">ÊúÄËøë1Âπ¥</option>
                                <option value="all" selected>ÊâÄÊúâÊó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportModuleData('reading', 'smart')">üìù Êô∫ËÉΩÊï¥ÁêÜ</button>
                            <button class="export-btn" onclick="exportModuleData('reading', 'json')">üìÑ JSONÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('reading', 'csv')">üìä CSVÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('reading', 'txt')">üìù ÊñáÊú¨Ê†ºÂºè</button>
                        </div>
                    </div>
                </div>

                <!-- ÊÉÖÁª™Ê®°Âùó -->
                <div id="emotion" class="module">
                    <h2>üòä ÊÉÖÁª™Áä∂ÊÄÅ</h2>
                    <div class="form-group">
                        <label>Êï¥‰ΩìÊÉÖÁª™</label>
                        <div class="emotion-grid">
                            <button class="emotion-btn" onclick="selectEmotion('ÂºÄÂøÉ')">üòä ÂºÄÂøÉ</button>
                            <button class="emotion-btn" onclick="selectEmotion('Âπ≥Èùô')">üòå Âπ≥Èùô</button>
                            <button class="emotion-btn" onclick="selectEmotion('ÂÖ¥Â•ã')">ü§© ÂÖ¥Â•ã</button>
                            <button class="emotion-btn" onclick="selectEmotion('ÁÑ¶Ëôë')">üò∞ ÁÑ¶Ëôë</button>
                            <button class="emotion-btn" onclick="selectEmotion('Áñ≤ÊÉ´')">üò¥ Áñ≤ÊÉ´</button>
                            <button class="emotion-btn" onclick="selectEmotion('Ê≤Æ‰∏ß')">üòî Ê≤Æ‰∏ß</button>
                            <button class="emotion-btn" onclick="selectEmotion('ÊÑ§ÊÄí')">üò† ÊÑ§ÊÄí</button>
                            <button class="emotion-btn" onclick="selectEmotion('Êª°Ë∂≥')">üòå Êª°Ë∂≥</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ÊÉÖÁª™Âº∫Â∫¶</label>
                        <div class="rating-group">
                            <span>Âº∫Â∫¶ËØÑÂàÜÔºö</span>
                            <div id="emotionIntensity">
                                <button class="rating-btn" onclick="setRating('emotionIntensity', 1)">1</button>
                                <button class="rating-btn" onclick="setRating('emotionIntensity', 2)">2</button>
                                <button class="rating-btn" onclick="setRating('emotionIntensity', 3)">3</button>
                                <button class="rating-btn" onclick="setRating('emotionIntensity', 4)">4</button>
                                <button class="rating-btn" onclick="setRating('emotionIntensity', 5)">5</button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ÊÉÖÁª™Ëß¶Âèë‰∫ã‰ª∂</label>
                        <textarea id="emotionTrigger" class="form-control" placeholder="ÊòØ‰ªÄ‰πà‰∫ãÊÉÖÂΩ±Âìç‰∫Ü‰Ω†ÁöÑÊÉÖÁª™Ôºü"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ÊÉÖÁª™Ë∞ÉËäÇÊñπÊ≥ï</label>
                        <textarea id="emotionRegulation" class="form-control" placeholder="‰Ω†ÊòØÂ¶Ç‰ΩïË∞ÉËäÇÊÉÖÁª™ÁöÑÔºü"></textarea>
                    </div>

                    <!-- ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
                    <div class="image-upload-section">
                        <label for="emotion-image" class="image-upload-label">
                            üì∑ ÁÇπÂáª‰∏ä‰º†ÊÉÖÁª™ÂõæÁâá
                        </label>
                        <input type="file" id="emotion-image" class="image-upload-input" accept="image/*" multiple>
                        <div id="emotion-image-preview" class="image-preview"></div>
                    </div>

                    <button class="btn-primary" onclick="saveEmotionData()">‰øùÂ≠òÊÉÖÁª™ËÆ∞ÂΩï</button>
                    
                    <!-- ÂØºÂá∫ÊåâÈíÆ -->
                    <div class="module-export-section">
                        <h4>üì§ ÂØºÂá∫ÊÉÖÁª™ËÆ∞ÂΩï</h4>
                        <div class="time-range-selector">
                            <label>Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                            <select id="emotionTimeRange" class="form-control">
                                <option value="1">ÊúÄËøë1Â§©</option>
                                <option value="7">ÊúÄËøë1Âë®</option>
                                <option value="30">ÊúÄËøë1‰∏™Êúà</option>
                                <option value="90">ÊúÄËøë3‰∏™Êúà</option>
                                <option value="180">ÊúÄËøë6‰∏™Êúà</option>
                                <option value="365">ÊúÄËøë1Âπ¥</option>
                                <option value="all" selected>ÊâÄÊúâÊó∂Èó¥</option>
                            </select>
                        </div>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportModuleData('emotion', 'smart')">üìù Êô∫ËÉΩÊï¥ÁêÜ</button>
                            <button class="export-btn" onclick="exportModuleData('emotion', 'json')">üìÑ JSONÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('emotion', 'csv')">üìä CSVÊ†ºÂºè</button>
                            <button class="export-btn" onclick="exportModuleData('emotion', 'txt')">üìù ÊñáÊú¨Ê†ºÂºè</button>
                        </div>
                    </div>
                </div>

                <!-- ÂõæÁâáÊó∂Èó¥ËΩ¥Ê®°Âùó -->
                <div id="timeline" class="module">
                    <h2>üì∏ ÂõæÁâáÊó∂Èó¥ËΩ¥</h2>
                    
                    <!-- Ê†áÁ≠æÁÆ°ÁêÜÈù¢Êùø -->
                    <div class="tag-management-panel">
                        <h3>üè∑Ô∏è Ê†áÁ≠æÁÆ°ÁêÜ‰∏≠ÂøÉ</h3>
                        <div class="tag-stats">
                            <div class="tag-stat-item">
                                <span class="tag-stat-number" id="totalTagsCount">0</span>
                                <span class="tag-stat-label">ÊÄªÊ†áÁ≠æÊï∞</span>
                            </div>
                            <div class="tag-stat-item">
                                <span class="tag-stat-number" id="taggedImagesCount">0</span>
                                <span class="tag-stat-label">Â∑≤Ê†áËÆ∞ÂõæÁâá</span>
                            </div>
                            <div class="tag-stat-item">
                                <span class="tag-stat-number" id="mostUsedTagCount">0</span>
                                <span class="tag-stat-label">ÊúÄÁÉ≠Ê†áÁ≠æ‰ΩøÁî®Ê¨°Êï∞</span>
                            </div>
                        </div>
                        <div class="tag-cloud" id="tagCloud">
                            <!-- Ê†áÁ≠æ‰∫ëÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                        </div>
                    </div>
                    
                    <!-- Êó∂Èó¥ËΩ¥ÊéßÂà∂Èù¢Êùø -->
                    <div class="timeline-controls">
                        <div class="timeline-filters">
                            <div class="filter-group">
                                <label>üìÖ Êó∂Èó¥ËåÉÂõ¥Ôºö</label>
                                <select id="timelineRange" class="form-control" onchange="filterTimeline()">
                                    <option value="7">ÊúÄËøë‰∏ÄÂë®</option>
                                    <option value="30">ÊúÄËøë‰∏ÄÊúà</option>
                                    <option value="90">ÊúÄËøë‰∏âÊúà</option>
                                    <option value="365">ÊúÄËøë‰∏ÄÂπ¥</option>
                                    <option value="all" selected>ÂÖ®ÈÉ®Êó∂Èó¥</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>üè∑Ô∏è Ê®°ÂùóÁ≠õÈÄâÔºö</label>
                                <select id="moduleFilter" class="form-control" onchange="filterTimeline()">
                                    <option value="all" selected>ÂÖ®ÈÉ®Ê®°Âùó</option>
                                    <option value="plan">üìÖ ËÆ°Âàí</option>
                                    <option value="exercise">üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®</option>
                                    <option value="study">üìö Â≠¶‰π†</option>
                                    <option value="reading">üìñ ÈòÖËØª</option>
                                    <option value="emotion">üòä ÊÉÖÁª™</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>üîç Ê†áÁ≠æÊêúÁ¥¢Ôºö</label>
                                <input type="text" id="tagSearch" class="form-control" placeholder="ËæìÂÖ•Ê†áÁ≠æÂÖ≥ÈîÆËØç" onkeyup="filterTimeline()">
                            </div>
                        </div>
                        
                        <div class="timeline-stats">
                            <div class="stat-item">
                                <span class="stat-label">ÊÄªÂõæÁâáÊï∞Ôºö</span>
                                <span id="totalImages" class="stat-value">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Â∑≤Á≠õÈÄâÔºö</span>
                                <span id="filteredImages" class="stat-value">0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Êó∂Èó¥ËΩ¥ÂÜÖÂÆπ -->
                    <div class="timeline-container">
                        <div id="timelineContent" class="timeline-content">
                            <div class="timeline-empty">
                                <div class="empty-icon">üì∑</div>
                                <h3>ËøòÊ≤°ÊúâÂõæÁâáËÆ∞ÂΩï</h3>
                                <p>ÂºÄÂßãÂú®ÂêÑ‰∏™Ê®°Âùó‰∏≠‰∏ä‰º†ÂõæÁâáÔºåËÆ∞ÂΩï‰Ω†ÁöÑÊàêÈïøÂéÜÁ®ãÂêßÔºÅ</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êï∞ÊçÆÈù¢Êùø -->
                <div id="dashboard" class="module">
                    <h2>üìä ÊàêÈïøÊï∞ÊçÆÈù¢Êùø</h2>
                    
                    <!-- ‰ªäÊó•ËÆ∞ÂΩïÊ¶ÇËßà -->
                    <div class="today-records-section">
                        <h3>üìÖ ‰ªäÊó•ËÆ∞ÂΩï</h3>
                        <div class="today-records-grid">
                            <div class="record-category">
                                <h4>üìã ‰ªäÊó•ËÆ°Âàí</h4>
                                <div id="todayPlans" class="record-list"></div>
                            </div>
                            <div class="record-category">
                                <h4>üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®ËÆ∞ÂΩï</h4>
                                <div id="todayExercises" class="record-list"></div>
                            </div>
                            <div class="record-category">
                                <h4>üìö Â≠¶‰π†ËÆ∞ÂΩï</h4>
                                <div id="todayStudies" class="record-list"></div>
                            </div>
                            <div class="record-category">
                                <h4>üìñ ÈòÖËØªËÆ∞ÂΩï</h4>
                                <div id="todayReadings" class="record-list"></div>
                            </div>
                            <div class="record-category">
                                <h4>üòä ÊÉÖÁª™ËÆ∞ÂΩï</h4>
                                <div id="todayEmotions" class="record-list"></div>
                            </div>
                        </div>
                    </div>

                    <div class="data-summary">
                        <div class="summary-card">
                            <h3>ÊÄªËÆ∞ÂΩïÂ§©Êï∞</h3>
                            <div class="value" id="totalDays">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>Âπ≥ÂùáËøêÂä®Êó∂Èïø</h3>
                            <div class="value" id="avgExercise">0ÂàÜÈíü</div>
                        </div>
                        <div class="summary-card">
                            <h3>Âπ≥ÂùáÂ≠¶‰π†Êó∂Èïø</h3>
                            <div class="value" id="avgStudy">0ÂàÜÈíü</div>
                        </div>
                        <div class="summary-card">
                            <h3>Âπ≥ÂùáÈòÖËØªÊó∂Èïø</h3>
                            <div class="value" id="avgReading">0ÂàÜÈíü</div>
                        </div>
                        <div class="summary-card">
                            <h3>ÊÉÖÁª™Âπ≥ÂùáÂàÜ</h3>
                            <div class="value" id="avgEmotion">0</div>
                        </div>
                        <div class="summary-card">
                            <h3>ÈòÖËØª‰π¶Á±çÊï∞Èáè</h3>
                            <div class="value" id="totalBooks">0Êú¨</div>
                        </div>
                        <!-- Êñ∞Â¢ûÂõæÁâáÁõ∏ÂÖ≥ÁªüËÆ° -->
                        <div class="summary-card image-stats">
                            <h3>üì∑ ÊÄªÂõæÁâáÊï∞Èáè</h3>
                            <div class="value" id="totalImagesCount">0Âº†</div>
                        </div>
                        <div class="summary-card image-stats">
                            <h3>üè∑Ô∏è Ê†áÁ≠æÊÄªÊï∞</h3>
                            <div class="value" id="totalTagsInStats">0‰∏™</div>
                        </div>
                        <div class="summary-card image-stats">
                            <h3>üìà Êú¨ÊúàÊñ∞Â¢ûÂõæÁâá</h3>
                            <div class="value" id="monthlyImages">0Âº†</div>
                        </div>
                    </div>

                    <!-- ÂõæÁâáÊàêÈïøÁªüËÆ°Èù¢Êùø -->
                    <div class="image-growth-panel">
                        <h3>üì∏ ÂõæÁâáÊàêÈïøÁªüËÆ°</h3>
                        <div class="image-stats-grid">
                            <div class="image-stat-card">
                                <h4>üìÖ ÊåâÊ®°ÂùóÂàÜÂ∏É</h4>
                                <div id="moduleDistribution" class="module-distribution"></div>
                            </div>
                            <div class="image-stat-card">
                                <h4>üìä ÊúàÂ∫¶Ë∂ãÂäø</h4>
                                <div id="monthlyTrend" class="monthly-trend"></div>
                            </div>
                            <div class="image-stat-card">
                                <h4>üèÜ ÁÉ≠Èó®Ê†áÁ≠æ TOP 10</h4>
                                <div id="topTags" class="top-tags-list"></div>
                            </div>
                            <div class="image-stat-card">
                                <h4>‚è∞ ‰∏ä‰º†Êó∂Èó¥ÂàÜÂ∏É</h4>
                                <div id="timeDistribution" class="time-distribution"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                    
                    <div class="export-section">
                        <h3>ÂØºÂá∫Êï∞ÊçÆ</h3>
                        <p>Â∞Ü‰Ω†ÁöÑÊàêÈïøÊï∞ÊçÆÂØºÂá∫‰∏∫ÂõæÁâáÊàñÊï∞ÊçÆÊñá‰ª∂</p>
                        <div class="export-buttons-grid">
                            <button class="export-btn" onclick="exportAsImage()">üì∏ ÂØºÂá∫‰∏∫ÂõæÁâá</button>
                            <button class="export-btn" onclick="exportAsData()">üìÑ ÂØºÂá∫Êï∞ÊçÆ</button>
                            <button class="export-btn" onclick="generateQRCode()">üì± ÁîüÊàê‰∫åÁª¥Á†Å</button>
                            <button class="export-btn" onclick="clearAllData()">üóëÔ∏è Ê∏ÖÁ©∫Êï∞ÊçÆ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂõæÁâáËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div id="imageModal" class="modal" style="display: none;">
        <div class="modal-content image-modal-content">
            <div class="modal-header">
                <h3>üì∑ ÂõæÁâáËØ¶ÊÉÖ</h3>
                <span class="close" onclick="closeImageModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="image-detail-container">
                    <div class="image-display">
                        <img id="modalImage" src="" alt="ÂõæÁâáÈ¢ÑËßà">
                    </div>
                    <div class="image-info">
                        <div class="form-group">
                            <label for="modalDescription">üìù ÂõæÁâáÊèèËø∞Ôºö</label>
                            <textarea id="modalDescription" placeholder="‰∏∫ËøôÂº†ÂõæÁâáÊ∑ªÂä†ÊèèËø∞ÔºåËÆ∞ÂΩïÂΩìÊó∂ÁöÑÂøÉÊÉÖ„ÄÅÊÉ≥Ê≥ïÊàñÊïÖ‰∫ã..." rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="modalTags">üè∑Ô∏è Ê†áÁ≠æÔºö</label>
                            <div class="tag-input-container">
                                <input type="text" id="modalTags" placeholder="ËæìÂÖ•Ê†áÁ≠æÂπ∂ÊåâÂõûËΩ¶Ê∑ªÂä†">
                                <div id="tagSuggestions" class="tag-suggestions"></div>
                            </div>
                            <div id="currentTags" class="current-tags"></div>
                            <div class="popular-tags">
                                <span class="popular-tags-label">Â∏∏Áî®Ê†áÁ≠æÔºö</span>
                                <div id="popularTags" class="popular-tags-list"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>‚è∞ ‰∏ä‰º†Êó∂Èó¥Ôºö</label>
                            <span id="modalTimestamp" class="timestamp"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeImageModal()">ÂèñÊ∂à</button>
                <button class="btn-primary" onclick="saveImageInfo()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÊï∞ÊçÆÂ≠òÂÇ®
        let growthData = JSON.parse(localStorage.getItem('growthData')) || {
            plans: [],
            exercises: [],
            studies: [],
            readings: [],
            emotions: []
        };

        // ÂõæÁâáÂ≠òÂÇ®
        let imageData = JSON.parse(localStorage.getItem('imageData')) || {
            plan: {},
            exercise: {},
            study: {},
            reading: {},
            emotion: {}
        };

        let currentRatings = {};
        let currentEmotion = '';
        let quotes = [];

        // ÂõæÁâá‰∏ä‰º†Â§ÑÁêÜÂáΩÊï∞
        function setupImageUpload() {
            const modules = ['plan', 'exercise', 'study', 'reading', 'emotion'];
            
            modules.forEach(module => {
                const input = document.getElementById(`${module}-image`);
                const preview = document.getElementById(`${module}-image-preview`);
                
                if (input && preview) {
                    input.addEventListener('change', function(e) {
                        handleImageUpload(e, module, preview);
                    });
                    
                    // ÊòæÁ§∫Â∑≤Â≠òÂÇ®ÁöÑÂõæÁâá
                    displayStoredImages(module, preview);
                }
            });
        }

        function handleImageUpload(event, module, previewContainer) {
            const files = event.target.files;
            
            for (let file of files) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageId = Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        const imageUrl = e.target.result;
                        
                        // Â≠òÂÇ®ÂõæÁâáÊï∞ÊçÆ
                        if (!imageData[module]) {
                            imageData[module] = {};
                        }
                        imageData[module][imageId] = {
                            url: imageUrl,
                            name: file.name,
                            timestamp: new Date().toISOString(),
                            description: '',
                            tags: []
                        };
                        
                        // ‰øùÂ≠òÂà∞localStorage
                        localStorage.setItem('imageData', JSON.stringify(imageData));
                        
                        // ÊòæÁ§∫ÂõæÁâá
                        displayImage(imageId, imageUrl, file.name, module, previewContainer);
                    };
                    reader.readAsDataURL(file);
                }
            }
            
            // Ê∏ÖÁ©∫input
            event.target.value = '';
        }

        function displayImage(imageId, imageUrl, imageName, module, container) {
            const imageItem = document.createElement('div');
            imageItem.className = 'image-item';
            imageItem.innerHTML = `
                <img src="${imageUrl}" alt="${imageName}" title="${imageName}" onclick="console.log('Image clicked:', '${imageId}', '${module}'); openImageModal('${imageId}', '${module}')">
                <button class="image-remove" onclick="removeImage('${imageId}', '${module}', this)">√ó</button>
                <div class="image-description-preview" onclick="console.log('Description clicked:', '${imageId}', '${module}'); openImageModal('${imageId}', '${module}')">
                    ${imageData[module][imageId]?.description ? imageData[module][imageId].description.substring(0, 20) + '...' : 'ÁÇπÂáªÊ∑ªÂä†ÊèèËø∞'}
                </div>
            `;
            container.appendChild(imageItem);
        }

        function displayStoredImages(module, container) {
            container.innerHTML = '';
            if (imageData[module]) {
                Object.entries(imageData[module]).forEach(([imageId, data]) => {
                    displayImage(imageId, data.url, data.name, module, container);
                });
            }
        }

        function removeImage(imageId, module, button) {
            // ‰ªéÊï∞ÊçÆ‰∏≠Âà†Èô§
            if (imageData[module] && imageData[module][imageId]) {
                delete imageData[module][imageId];
                localStorage.setItem('imageData', JSON.stringify(imageData));
            }
            
            // ‰ªéDOM‰∏≠Âà†Èô§
            button.parentElement.remove();
        }

        // Ëé∑ÂèñÊ®°ÂùóÁöÑÂõæÁâáÊï∞ÊçÆ
        function getModuleImages(module) {
            return imageData[module] || {};
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫ÊòéÂ§©
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('planDate').value = tomorrow.toISOString().split('T')[0];
            
            // ÂàùÂßãÂåñÂõæÁâá‰∏ä‰º†ÂäüËÉΩ
            setupImageUpload();
            
            // ÂàùÂßãÂåñÊ†áÁ≠æÁ≥ªÁªü
            initTagSystem();
            
            // ÂàùÂßãÂåñÁî®Êà∑ÂßìÂêçÂíåÊØèÊó•ËØ≠ÂΩï
            initializeUserName();
            updateDailyQuote();
            
            updateDashboard();
        });

        // ÊòæÁ§∫Ê®°Âùó
        function showModule(moduleId) {
            // ÈöêËóèÊâÄÊúâÊ®°Âùó
            document.querySelectorAll('.module').forEach(module => {
                module.classList.remove('active');
            });
            
            // ÁßªÈô§ÊâÄÊúâÂØºËà™È°πÁöÑactiveÁä∂ÊÄÅ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ®°Âùó
            document.getElementById(moduleId).classList.add('active');
            
            // ËÆæÁΩÆÂØπÂ∫îÂØºËà™È°π‰∏∫active
            event.target.classList.add('active');
            
            // Â¶ÇÊûúÊòØÊï∞ÊçÆÈù¢ÊùøÔºåÊõ¥Êñ∞ÂõæË°®
            if (moduleId === 'dashboard') {
                updateDashboard();
            }
        }

        // ËÆæÁΩÆËØÑÂàÜ
        function setRating(type, rating) {
            currentRatings[type] = rating;
            
            // Êõ¥Êñ∞UI
            const ratingContainer = document.getElementById(type);
            if (ratingContainer) {
                const buttons = ratingContainer.querySelectorAll('.rating-btn');
                buttons.forEach((btn, index) => {
                    if (index < rating) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }
        }

        // ÈÄâÊã©ÊÉÖÁª™
        function selectEmotion(emotion) {
            currentEmotion = emotion;
            
            // Êõ¥Êñ∞UI
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
        }

        // Ê∑ªÂä†ÊëòÂΩï
        function addQuote() {
            const quoteText = document.getElementById('readingQuotes').value.trim();
            if (quoteText) {
                quotes.push({
                    text: quoteText,
                    date: new Date().toLocaleDateString()
                });
                
                updateQuotesDisplay();
                document.getElementById('readingQuotes').value = '';
            }
        }

        // Êõ¥Êñ∞ÊëòÂΩïÊòæÁ§∫
        function updateQuotesDisplay() {
            const container = document.getElementById('quotesContainer');
            container.innerHTML = quotes.map(quote => `
                <div class="quote-item">
                    <div class="quote-text">"${quote.text}"</div>
                    <div class="quote-reflection">ÊëòÂΩï‰∫é ${quote.date}</div>
                </div>
            `).join('');
        }

        // ‰øùÂ≠òËÆ°ÂàíÊï∞ÊçÆ
        function savePlanData() {
            const selectedDate = document.getElementById('planDate').value;
            
            // Â¶ÇÊûúÈÄâÊã©ÁöÑÊòØÊòéÊó•ËÆ°ÂàíÔºåËÆæÁΩÆ‰øùÂ≠òÊó∂Èó¥‰∏∫Á¨¨2Â§©ÂáåÊô®
            let saveDate;
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            if (selectedDate === tomorrow.toISOString().split('T')[0]) {
                // ÊòéÊó•ËÆ°ÂàíÔºåËÆæÁΩÆ‰∏∫Á¨¨2Â§©ÂáåÊô®ÔºàÂç≥ÂêéÂ§©ÂáåÊô®Ôºâ
                const dayAfterTomorrow = new Date(tomorrow);
                dayAfterTomorrow.setDate(tomorrow.getDate() + 1);
                dayAfterTomorrow.setHours(0, 0, 0, 0);
                saveDate = dayAfterTomorrow.toLocaleDateString();
            } else {
                // ÂÖ∂‰ªñÊó•ÊúüÁöÑËÆ°ÂàíÔºå‰ΩøÁî®ÈÄâÊã©ÁöÑÊó•Êúü
                saveDate = new Date(selectedDate).toLocaleDateString();
            }
            
            const planData = {
                date: saveDate,
                originalDate: selectedDate, // ‰øùÁïôÂéüÂßãÈÄâÊã©ÁöÑÊó•Êúü
                mainGoals: document.getElementById('mainGoals').value,
                detailPlan: document.getElementById('detailPlan').value,
                expectedCompletion: currentRatings.plan || 0,
                images: getModuleImages('plan'),
                timestamp: new Date().toISOString()
            };
            
            growthData.plans.push(planData);
            saveToLocalStorage();
            updateDashboard();
            alert('ËÆ°ÂàíÂ∑≤‰øùÂ≠òÔºÅ');
            clearPlanForm();
        }

        // Â≠¶‰π†‰∏ªÈ¢òÁÆ°ÁêÜ
        let studyTopics = [];

        // Ê∑ªÂä†Â≠¶‰π†‰∏ªÈ¢ò
        function addStudyTopic() {
            const input = document.getElementById('newStudyTopic');
            const topicName = input.value.trim();
            
            if (!topicName) {
                alert('ËØ∑ËæìÂÖ•Â≠¶‰π†‰∏ªÈ¢ò');
                return;
            }
            
            if (studyTopics.some(topic => topic.name === topicName)) {
                alert('ËØ•‰∏ªÈ¢òÂ∑≤Â≠òÂú®');
                return;
            }
            
            const topic = {
                name: topicName,
                duration: 0
            };
            
            studyTopics.push(topic);
            input.value = '';
            renderStudyTopics();
            updateTimeAllocation();
        }

        // Ê∏≤ÊüìÂ≠¶‰π†‰∏ªÈ¢òÊ†áÁ≠æ
        function renderStudyTopics() {
            const container = document.getElementById('studyTopicTags');
            container.innerHTML = '';
            
            studyTopics.forEach((topic, index) => {
                const tag = document.createElement('div');
                tag.className = 'topic-tag';
                tag.innerHTML = `
                    <span class="topic-name">${topic.name}</span>
                    <div class="topic-time-input">
                        <input type="number" 
                               value="${topic.duration || ''}" 
                               placeholder="ÂàÜÈíü" 
                               min="0" 
                               onchange="updateTopicTime(${index}, this.value)"
                               onclick="event.stopPropagation()">
                        <span class="time-unit">ÂàÜÈíü</span>
                    </div>
                    <button class="remove-btn" onclick="removeStudyTopic(${index})">√ó</button>
                `;
                container.appendChild(tag);
            });
            
            updateTotalTime();
        }

        // Êõ¥Êñ∞Âçï‰∏™‰∏ªÈ¢òÁöÑÊó∂Èó¥
        function updateTopicTime(index, duration) {
            const numDuration = parseInt(duration) || 0;
            studyTopics[index].duration = numDuration;
            updateTotalTime();
        }

        // Âà†Èô§Â≠¶‰π†‰∏ªÈ¢ò
        function removeStudyTopic(index) {
            studyTopics.splice(index, 1);
            renderStudyTopics();
        }

        // Êõ¥Êñ∞ÊÄªÊó∂Èó¥ÊòæÁ§∫
        function updateTotalTime() {
            const totalMinutes = studyTopics.reduce((sum, topic) => sum + (topic.duration || 0), 0);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            const minutesDisplay = document.querySelector('.time-minutes');
            const hoursDisplay = document.querySelector('.time-hours');
            
            if (minutesDisplay) {
                minutesDisplay.textContent = `${totalMinutes}ÂàÜÈíü`;
            }
            
            if (hoursDisplay) {
                if (hours > 0) {
                    hoursDisplay.textContent = `(${hours}Â∞èÊó∂${minutes > 0 ? minutes + 'ÂàÜÈíü' : ''})`;
                } else {
                    hoursDisplay.textContent = minutes > 0 ? `(${minutes}ÂàÜÈíü)` : '(0Â∞èÊó∂)';
                }
            }
        }



        // Â§ÑÁêÜËøêÂä®Á±ªÂûãÈÄâÊã©
        function handleExerciseTypeChange() {
            const select = document.getElementById('exerciseTypeSelect');
            const input = document.getElementById('exerciseType');
            
            if (select.value === 'ÂÖ∂‰ªñ') {
                input.style.display = 'block';
                input.focus();
            } else {
                input.style.display = 'none';
                input.value = select.value;
            }
        }

        // ‰øùÂ≠òËøêÂä®Êï∞ÊçÆ
        function saveExerciseData() {
            const select = document.getElementById('exerciseTypeSelect');
            const input = document.getElementById('exerciseType');
            const exerciseType = select.value === 'ÂÖ∂‰ªñ' ? input.value : select.value;
            
            // ËÆæÁΩÆ‰øùÂ≠òÊó∂Èó¥‰∏∫ÂΩìÂ§©Êôö‰∏ä12ÁÇπ
            const now = new Date();
            const endOfDay = new Date(now);
            endOfDay.setHours(23, 59, 59, 999); // ÂΩìÂ§©Êôö‰∏ä11:59:59
            
            const exerciseData = {
                type: exerciseType,
                duration: parseInt(document.getElementById('exerciseDuration').value) || 0,
                intensity: currentRatings.exerciseIntensity || 0,
                feeling: document.getElementById('exerciseFeeling').value,
                images: getModuleImages('exercise'),
                date: now.toLocaleDateString(),
                expiryTime: endOfDay.toISOString(), // ËÆ∞ÂΩïËøáÊúüÊó∂Èó¥
                timestamp: new Date().toISOString()
            };
            
            growthData.exercises.push(exerciseData);
            saveToLocalStorage();
            updateDashboard();
            alert('ËøêÂä®ËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ');
            clearExerciseForm();
        }

        // ‰øùÂ≠òÂ≠¶‰π†Êï∞ÊçÆ
        function saveStudyData() {
            if (studyTopics.length === 0) {
                alert('ËØ∑ÂÖàÊ∑ªÂä†Â≠¶‰π†‰∏ªÈ¢ò');
                return;
            }
            
            // È™åËØÅÊØè‰∏™‰∏ªÈ¢òÈÉΩÊúâÊó∂Èó¥ËæìÂÖ•
            const hasEmptyTime = studyTopics.some(topic => !topic.duration || topic.duration <= 0);
            if (hasEmptyTime) {
                alert('ËØ∑‰∏∫ÊØè‰∏™Â≠¶‰π†‰∏ªÈ¢òËæìÂÖ•Êó∂Èó¥');
                return;
            }
            
            const totalDuration = studyTopics.reduce((sum, topic) => sum + (topic.duration || 0), 0);
            
            // ËÆæÁΩÆ‰øùÂ≠òÊó∂Èó¥‰∏∫ÂΩìÂ§©Êôö‰∏ä12ÁÇπ
            const now = new Date();
            const endOfDay = new Date(now);
            endOfDay.setHours(23, 59, 59, 999); // ÂΩìÂ§©Êôö‰∏ä11:59:59
            
            const studyData = {
                topics: studyTopics.map(topic => ({
                    name: topic.name,
                    duration: topic.duration
                })),
                totalDuration: totalDuration,
                content: document.getElementById('studyContent').value,
                mastery: currentRatings.studyMastery || 0,
                gains: document.getElementById('studyGains').value,
                images: getModuleImages('study'),
                date: now.toLocaleDateString(),
                expiryTime: endOfDay.toISOString(), // ËÆ∞ÂΩïËøáÊúüÊó∂Èó¥
                timestamp: new Date().toISOString()
            };
            
            growthData.studies.push(studyData);
            saveToLocalStorage();
            updateDashboard();
            alert('Â≠¶‰π†ËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ');
            clearStudyForm();
        }

        // ‰øùÂ≠òÈòÖËØªÊï∞ÊçÆ
        function saveReadingData() {
            // ËÆæÁΩÆ‰øùÂ≠òÊó∂Èó¥‰∏∫ÂΩìÂ§©Êôö‰∏ä12ÁÇπ
            const now = new Date();
            const endOfDay = new Date(now);
            endOfDay.setHours(23, 59, 59, 999); // ÂΩìÂ§©Êôö‰∏ä11:59:59
            
            const readingData = {
                title: document.getElementById('readingTitle').value,
                progress: document.getElementById('readingProgress').value,
                quotes: [...quotes],
                reflection: document.getElementById('readingReflection').value,
                rating: currentRatings.readingRating || 0,
                images: getModuleImages('reading'),
                date: now.toLocaleDateString(),
                expiryTime: endOfDay.toISOString(), // ËÆ∞ÂΩïËøáÊúüÊó∂Èó¥
                timestamp: new Date().toISOString()
            };
            
            growthData.readings.push(readingData);
            saveToLocalStorage();
            updateDashboard();
            alert('ÈòÖËØªËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ');
            clearReadingForm();
        }

        // ‰øùÂ≠òÊÉÖÁª™Êï∞ÊçÆ
        function saveEmotionData() {
            const emotionData = {
                emotion: currentEmotion,
                intensity: currentRatings.emotionIntensity || 0,
                trigger: document.getElementById('emotionTrigger').value,
                regulation: document.getElementById('emotionRegulation').value,
                images: getModuleImages('emotion'),
                date: new Date().toLocaleDateString(),
                timestamp: new Date().toISOString()
            };
            
            growthData.emotions.push(emotionData);
            saveToLocalStorage();
            updateDashboard();
            alert('ÊÉÖÁª™ËÆ∞ÂΩïÂ∑≤‰øùÂ≠òÔºÅ');
            clearEmotionForm();
        }

        // Ê∏ÖÁ©∫Ë°®Âçï
        function clearPlanForm() {
            document.getElementById('mainGoals').value = '';
            document.getElementById('detailPlan').value = '';
            currentRatings.plan = 0;
            document.querySelectorAll('#planRating .rating-btn').forEach(btn => btn.classList.remove('active'));
        }

        function clearExerciseForm() {
            document.getElementById('exerciseType').value = '';
            document.getElementById('exerciseDuration').value = '';
            document.getElementById('exerciseFeeling').value = '';
            currentRatings.exerciseIntensity = 0;
            document.querySelectorAll('#exerciseIntensity .rating-btn').forEach(btn => btn.classList.remove('active'));
        }

        function clearStudyForm() {
            studyTopics = [];
            renderStudyTopics();
            document.getElementById('newStudyTopic').value = '';
            document.getElementById('studyContent').value = '';
            document.getElementById('studyGains').value = '';
            currentRatings.studyMastery = 0;
            document.querySelectorAll('#studyMastery .rating-btn').forEach(btn => btn.classList.remove('active'));
        }

        function clearReadingForm() {
            document.getElementById('readingTitle').value = '';
            document.getElementById('readingProgress').value = '';
            document.getElementById('readingQuotes').value = '';
            document.getElementById('readingReflection').value = '';
            quotes = [];
            updateQuotesDisplay();
            currentRatings.readingRating = 0;
            document.querySelectorAll('#readingRating .rating-btn').forEach(btn => btn.classList.remove('active'));
        }

        function clearEmotionForm() {
            document.getElementById('emotionTrigger').value = '';
            document.getElementById('emotionRegulation').value = '';
            currentEmotion = '';
            currentRatings.emotionIntensity = 0;
            document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('#emotionIntensity .rating-btn').forEach(btn => btn.classList.remove('active'));
        }

        // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveToLocalStorage() {
            localStorage.setItem('growthData', JSON.stringify(growthData));
        }

        // Êõ¥Êñ∞Êï∞ÊçÆÈù¢Êùø
        function updateDashboard() {
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const totalDays = new Set([
                ...growthData.exercises.map(e => e.date),
                ...growthData.studies.map(s => s.date),
                ...growthData.readings.map(r => r.date),
                ...growthData.emotions.map(em => em.date)
            ]).size;

            const avgExercise = growthData.exercises.length > 0 
                ? Math.round(growthData.exercises.reduce((sum, e) => sum + e.duration, 0) / growthData.exercises.length)
                : 0;

            const avgStudy = growthData.studies.length > 0
                ? Math.round(growthData.studies.reduce((sum, s) => {
                    // ÊîØÊåÅÊñ∞ÁöÑÂ§ö‰∏ªÈ¢òÁªìÊûÑÂíåÊóßÁöÑÂçï‰∏ªÈ¢òÁªìÊûÑ
                    if (s.topics && Array.isArray(s.topics)) {
                        return sum + s.totalDuration;
                    } else {
                        return sum + (s.duration || 0);
                    }
                }, 0) / growthData.studies.length)
                : 0;

            // ËÆ°ÁÆóÈòÖËØªÊï∞ÊçÆ
            const avgReading = growthData.readings.length > 0
                ? Math.round(growthData.readings.reduce((sum, r) => {
                    // Â∞ùËØï‰ªéprogressÂ≠óÊÆµÊèêÂèñÊó∂ÈïøÔºàÂ¶ÇÊûúÂåÖÂê´"ÂàÜÈíü"Ôºâ
                    const match = r.progress.match(/(\d+)ÂàÜÈíü/);
                    return sum + (match ? parseInt(match[1]) : 0);
                }, 0) / growthData.readings.length)
                : 0;

            const totalBooks = new Set(growthData.readings.map(r => r.title)).size;

            const avgEmotion = growthData.emotions.length > 0
                ? (growthData.emotions.reduce((sum, e) => sum + e.intensity, 0) / growthData.emotions.length).toFixed(1)
                : 0;

            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('totalDays').textContent = totalDays;
            document.getElementById('avgExercise').textContent = avgExercise + 'ÂàÜÈíü';
            document.getElementById('avgStudy').textContent = avgStudy + 'ÂàÜÈíü';
            document.getElementById('avgReading').textContent = avgReading + 'ÂàÜÈíü';
            document.getElementById('totalBooks').textContent = totalBooks + 'Êú¨';
            document.getElementById('avgEmotion').textContent = avgEmotion;

            // Êõ¥Êñ∞‰ªäÊó•ËÆ∞ÂΩïÊòæÁ§∫
            updateTodayRecords();

            // Êõ¥Êñ∞ÂõæË°®
            updateChart();
        }

        // Êõ¥Êñ∞‰ªäÊó•ËÆ∞ÂΩïÊòæÁ§∫
        function updateTodayRecords() {
            const today = new Date().toLocaleDateString();
            
            // ÊòæÁ§∫‰ªäÊó•ËÆ°Âàí
            const todayPlans = growthData.plans.filter(p => p.date === today);
            displayTodayRecords('todayPlans', todayPlans, (plan) => 
                `<div class="record-item">
                    <strong>ÁõÆÊ†áÔºö</strong>${plan.mainGoals}<br>
                    <strong>ËØ¶ÁªÜËÆ°ÂàíÔºö</strong>${plan.detailPlan}
                    <div class="record-time">${new Date(plan.timestamp).toLocaleTimeString()}</div>
                </div>`
            );

            // ÊòæÁ§∫‰ªäÊó•ËøêÂä®
            const todayExercises = growthData.exercises.filter(e => e.date === today);
            displayTodayRecords('todayExercises', todayExercises, (exercise) => 
                `<div class="record-item">
                    <strong>${exercise.type}</strong> - ${exercise.duration}ÂàÜÈíü<br>
                    Âº∫Â∫¶Ôºö${exercise.intensity}/5 ${exercise.feeling ? '| ' + exercise.feeling : ''}
                    <div class="record-time">${new Date(exercise.timestamp).toLocaleTimeString()}</div>
                </div>`
            );

            // ÊòæÁ§∫‰ªäÊó•Â≠¶‰π†
            const todayStudies = growthData.studies.filter(s => s.date === today);
            displayTodayRecords('todayStudies', todayStudies, (study) => {
                const duration = study.topics ? study.totalDuration : (study.duration || 0);
                const topics = study.topics ? study.topics.map(t => t.name).join(', ') : (study.subject || '');
                return `<div class="record-item">
                    <strong>‰∏ªÈ¢òÔºö</strong>${topics}<br>
                    <strong>Êó∂ÈïøÔºö</strong>${duration}ÂàÜÈíü | ÊéåÊè°Â∫¶Ôºö${study.mastery}/5
                    <div class="record-time">${new Date(study.timestamp).toLocaleTimeString()}</div>
                </div>`;
            });

            // ÊòæÁ§∫‰ªäÊó•ÈòÖËØª
            const todayReadings = growthData.readings.filter(r => r.date === today);
            displayTodayRecords('todayReadings', todayReadings, (reading) => 
                `<div class="record-item">
                    <strong>‰π¶Á±çÔºö</strong>${reading.title}<br>
                    <strong>ËøõÂ∫¶Ôºö</strong>${reading.progress} | Êé®ËçêÂ∫¶Ôºö${reading.rating}/5
                    <div class="record-time">${new Date(reading.timestamp).toLocaleTimeString()}</div>
                </div>`
            );

            // ÊòæÁ§∫‰ªäÊó•ÊÉÖÁª™
            const todayEmotions = growthData.emotions.filter(e => e.date === today);
            displayTodayRecords('todayEmotions', todayEmotions, (emotion) => 
                `<div class="record-item">
                    <strong>ÊÉÖÁª™Ôºö</strong>${emotion.emotion} (Âº∫Â∫¶Ôºö${emotion.intensity}/5)<br>
                    ${emotion.trigger ? '<strong>Ëß¶Âèë‰∫ã‰ª∂Ôºö</strong>' + emotion.trigger : ''}
                    <div class="record-time">${new Date(emotion.timestamp).toLocaleTimeString()}</div>
                </div>`
            );
        }

        // ÈÄöÁî®ÁöÑËÆ∞ÂΩïÊòæÁ§∫ÂáΩÊï∞
        function displayTodayRecords(containerId, records, formatFunction) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (records.length === 0) {
                container.innerHTML = '<div class="no-records">‰ªäÊó•ÊöÇÊó†ËÆ∞ÂΩï</div>';
            } else {
                container.innerHTML = records.map(formatFunction).join('');
            }
        }

        // Êõ¥Êñ∞ÂõæË°®
        function updateChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            // Ëé∑ÂèñÊúÄËøë7Â§©ÁöÑÊï∞ÊçÆ
            const last7Days = [];
            const today = new Date();
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString());
            }

            const exerciseData = last7Days.map(date => {
                const dayExercise = growthData.exercises.filter(e => e.date === date);
                return dayExercise.reduce((sum, e) => sum + e.duration, 0);
            });

            const studyData = last7Days.map(date => {
                const dayStudy = growthData.studies.filter(s => s.date === date);
                return dayStudy.reduce((sum, s) => {
                    // ÊîØÊåÅÊñ∞ÁöÑÂ§ö‰∏ªÈ¢òÁªìÊûÑÂíåÊóßÁöÑÂçï‰∏ªÈ¢òÁªìÊûÑ
                    if (s.topics && Array.isArray(s.topics)) {
                        return sum + s.totalDuration;
                    } else {
                        return sum + (s.duration || 0);
                    }
                }, 0);
            });

            const readingData = last7Days.map(date => {
                const dayReading = growthData.readings.filter(r => r.date === date);
                return dayReading.reduce((sum, r) => {
                    // ÊèêÂèñÈòÖËØªÊó∂ÈïøÔºàÂàÜÈíüÔºâ
                    if (r.progress) {
                        const match = r.progress.match(/(\d+)ÂàÜÈíü/);
                        return sum + (match ? parseInt(match[1]) : 0);
                    }
                    return sum;
                }, 0);
            });

            const emotionData = last7Days.map(date => {
                const dayEmotion = growthData.emotions.filter(e => e.date === date);
                return dayEmotion.length > 0 ? dayEmotion[0].intensity : 0;
            });

            // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
            if (window.growthChart && typeof window.growthChart.destroy === 'function') {
                window.growthChart.destroy();
            }

            // ÂàõÂª∫Êñ∞ÂõæË°®
            window.growthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(date => {
                        const d = new Date(date);
                        return (d.getMonth() + 1) + '/' + d.getDate();
                    }),
                    datasets: [{
                        label: 'ËøêÂä®Êó∂Èïø(ÂàÜÈíü)',
                        data: exerciseData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Â≠¶‰π†Êó∂Èïø(ÂàÜÈíü)',
                        data: studyData,
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'ÈòÖËØªÊó∂Èïø(ÂàÜÈíü)',
                        data: readingData,
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'ÊÉÖÁª™ËØÑÂàÜ',
                        data: emotionData.map(score => score * 20), // ÊîæÂ§ßÊòæÁ§∫
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Êó∂Èïø(ÂàÜÈíü)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'ÊÉÖÁª™ËØÑÂàÜ'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ÊúÄËøë7Â§©ÊàêÈïøË∂ãÂäø'
                        }
                    }
                }
            });
        }

        // ÂØºÂá∫‰∏∫ÂõæÁâá
        async function exportAsImage() {
            const dashboard = document.getElementById('dashboard');
            
            // ÂàõÂª∫ÂåÖÂê´ÂõæÁâáÁöÑÂÆåÊï¥ÂØºÂá∫ÂÜÖÂÆπ
            const exportContent = document.createElement('div');
            exportContent.style.cssText = `
                background: white;
                padding: 30px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                max-width: 800px;
                margin: 0 auto;
            `;
            
            // Ê∑ªÂä†Ê†áÈ¢ò
            const title = document.createElement('h1');
            title.textContent = '‰∏™‰∫∫ÊàêÈïø‰ª™Ë°®Êùø';
            title.style.cssText = `
                text-align: center;
                color: #333;
                margin-bottom: 30px;
                font-size: 28px;
            `;
            exportContent.appendChild(title);
            
            // Ê∑ªÂä†Êó•Êúü
            const dateDiv = document.createElement('div');
            dateDiv.textContent = `ÁîüÊàêÊó∂Èó¥: ${new Date().toLocaleString()}`;
            dateDiv.style.cssText = `
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 14px;
            `;
            exportContent.appendChild(dateDiv);
            
            // ÂÖãÈöÜ‰ª™Ë°®ÊùøÂÜÖÂÆπ
            const dashboardClone = dashboard.cloneNode(true);
            exportContent.appendChild(dashboardClone);
            
            // Ê∑ªÂä†ÂêÑÊ®°ÂùóÁöÑÂõæÁâá
            const modules = ['plan', 'exercise', 'study', 'reading', 'emotion'];
            const moduleNames = {
                plan: 'ËÆ°ÂàíÊ®°Âùó',
                exercise: 'ËøêÂä®Ê®°Âùó', 
                study: 'Â≠¶‰π†Ê®°Âùó',
                reading: 'ÈòÖËØªÊ®°Âùó',
                emotion: 'ÊÉÖÁª™Ê®°Âùó'
            };
            
            for (const module of modules) {
                const moduleImages = getModuleImages(module);
                if (Object.keys(moduleImages).length > 0) {
                    const moduleSection = document.createElement('div');
                    moduleSection.style.cssText = `
                        margin-top: 30px;
                        padding: 20px;
                        border: 1px solid #e0e0e0;
                        border-radius: 10px;
                    `;
                    
                    const moduleTitle = document.createElement('h3');
                    moduleTitle.textContent = moduleNames[module] + ' - Áõ∏ÂÖ≥ÂõæÁâá';
                    moduleTitle.style.cssText = `
                        color: #333;
                        margin-bottom: 15px;
                        font-size: 18px;
                    `;
                    moduleSection.appendChild(moduleTitle);
                    
                    const imageGrid = document.createElement('div');
                    imageGrid.style.cssText = `
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                    `;
                    
                    Object.values(moduleImages).forEach(imageData => {
                        const imgContainer = document.createElement('div');
                        imgContainer.style.cssText = `
                            text-align: center;
                        `;
                        
                        const img = document.createElement('img');
                        img.src = imageData.url;
                        img.style.cssText = `
                            max-width: 100%;
                            height: 150px;
                            object-fit: cover;
                            border-radius: 8px;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        `;
                        
                        const imgName = document.createElement('div');
                        imgName.textContent = imageData.name;
                        imgName.style.cssText = `
                            font-size: 12px;
                            color: #666;
                            margin-top: 5px;
                        `;
                        
                        imgContainer.appendChild(img);
                        imgContainer.appendChild(imgName);
                        imageGrid.appendChild(imgContainer);
                    });
                    
                    moduleSection.appendChild(imageGrid);
                    exportContent.appendChild(moduleSection);
                }
            }
            
            // ‰∏¥Êó∂Ê∑ªÂä†Âà∞È°µÈù¢ËøõË°åÊà™Âõæ
            document.body.appendChild(exportContent);
            
            try {
                const canvas = await html2canvas(exportContent, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true,
                    allowTaint: false,
                    foreignObjectRendering: false,
                    logging: false,
                    width: exportContent.scrollWidth,
                    height: exportContent.scrollHeight
                });
                
                // ‰∏ãËΩΩÂõæÁâá
                const link = document.createElement('a');
                link.download = `ÊàêÈïø‰ª™Ë°®Êùø_${new Date().toLocaleDateString().replace(/\//g, '-')}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                alert('ÊàêÈïø‰ª™Ë°®ÊùøÂ∑≤ÂØºÂá∫‰∏∫ÂõæÁâáÔºÅ');
            } catch (error) {
                console.error('ÂØºÂá∫Â§±Ë¥•:', error);
                alert('ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ');
            } finally {
                // ÁßªÈô§‰∏¥Êó∂ÂÖÉÁ¥†
                document.body.removeChild(exportContent);
            }
        }

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportAsData() {
            const exportObj = {
                growthData: growthData,
                imageData: imageData,
                quotes: quotes,
                exportDate: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(exportObj, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ÊàêÈïøÊï∞ÊçÆ_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert('Êï∞ÊçÆÂ∑≤ÂØºÂá∫‰∏∫JSONÊñá‰ª∂ÔºÅ');
        }

        // Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ
        function clearAllData() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                growthData = {
                    plans: [],
                    exercises: [],
                    studies: [],
                    readings: [],
                    emotions: []
                };
                localStorage.removeItem('growthData');
                updateDashboard();
                alert('ÊâÄÊúâÊï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫ÔºÅ');
            }
        }

        // ÁîüÊàê‰∫åÁª¥Á†ÅÂäüËÉΩ
        function generateQRCode() {
            const currentUrl = window.location.href;
            const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(currentUrl)}`;
            
            // ÂàõÂª∫Ê®°ÊÄÅÊ°ÜÊòæÁ§∫‰∫åÁª¥Á†Å
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 400px;
                width: 90%;
            `;
            
            content.innerHTML = `
                <h3 style="margin-top: 0; color: #333;">üì± Êâ´Á†ÅÂàÜ‰∫´</h3>
                <p style="color: #666; margin-bottom: 20px;">Êâ´Êèè‰∫åÁª¥Á†ÅÂú®ÊâãÊú∫‰∏ä‰ΩøÁî®</p>
                <img src="${qrApiUrl}" style="width: 250px; height: 250px; border: 2px solid #ddd; border-radius: 10px;" alt="‰∫åÁª¥Á†Å">
                <div style="margin-top: 20px;">
                    <button onclick="downloadQR('${qrApiUrl}')" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 25px;
                        cursor: pointer;
                        margin: 5px;
                        font-size: 14px;
                    ">üíæ ‰∏ãËΩΩ‰∫åÁª¥Á†Å</button>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                        background: #f0f0f0;
                        color: #333;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 25px;
                        cursor: pointer;
                        margin: 5px;
                        font-size: 14px;
                    ">ÂÖ≥Èó≠</button>
                </div>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // ÁÇπÂáªËÉåÊôØÂÖ≥Èó≠
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // ‰∏ãËΩΩ‰∫åÁª¥Á†Å
        function downloadQR(qrUrl) {
            const link = document.createElement('a');
            link.href = qrUrl;
            link.download = 'ÊàêÈïø‰ª™Ë°®Êùø‰∫åÁª¥Á†Å.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ÂØºÂá∫Ê®°ÂùóÊï∞ÊçÆ
        function exportModuleData(moduleType, format) {
            // Â¶ÇÊûúÊòØÊô∫ËÉΩÊï¥ÁêÜÂØºÂá∫
            if (format === 'smart') {
                exportSmartSummary(moduleType);
                return;
            }
            
            // Ëé∑ÂèñÊó∂Èó¥ËåÉÂõ¥Á≠õÈÄâÁöÑÊï∞ÊçÆ
            const timeRangeSelect = document.getElementById(moduleType + 'TimeRange');
            const timeRange = timeRangeSelect ? timeRangeSelect.value : 'all';
            let data = [];
            let filename = '';
            
            switch(moduleType) {
                case 'plan':
                    data = growthData.plans;
                    filename = 'ËÆ°ÂàíÊï∞ÊçÆ';
                    break;
                case 'exercise':
                    data = growthData.exercises;
                    filename = 'ËøêÂä®Êï∞ÊçÆ';
                    break;
                case 'study':
                    data = growthData.studies;
                    filename = 'Â≠¶‰π†Êï∞ÊçÆ';
                    break;
                case 'reading':
                    data = growthData.readings;
                    filename = 'ÈòÖËØªÊï∞ÊçÆ';
                    break;
                case 'emotion':
                    data = growthData.emotions;
                    filename = 'ÊÉÖÁª™Êï∞ÊçÆ';
                    break;
            }
            
            // Â∫îÁî®Êó∂Èó¥ËåÉÂõ¥Á≠õÈÄâ
            if (timeRange !== 'all') {
                const days = parseInt(timeRange);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                data = data.filter(item => {
                    const itemDate = new Date(item.timestamp || item.date);
                    return itemDate >= cutoffDate;
                });
            }
            
            if (data.length === 0) {
                alert('ÊâÄÈÄâÊó∂Èó¥ËåÉÂõ¥ÂÜÖÊöÇÊó†Êï∞ÊçÆÂèØÂØºÂá∫ÔºÅ');
                return;
            }
            
            const timeRangeText = getTimeRangeText(timeRange);
            const dateStr = new Date().toLocaleDateString().replace(/\//g, '-');
            
            if (format === 'json') {
                const dataStr = JSON.stringify(data, null, 2);
                downloadFile(dataStr, `${filename}_${timeRangeText}_${dateStr}.json`, 'application/json');
            } else if (format === 'csv') {
                const csvStr = convertToCSV(data, moduleType);
                downloadFile(csvStr, `${filename}_${timeRangeText}_${dateStr}.csv`, 'text/csv');
            } else if (format === 'txt') {
                const txtStr = convertToTXT(data, moduleType);
                downloadFile(txtStr, `${filename}_${timeRangeText}_${dateStr}.txt`, 'text/plain');
            }
        }

        // Ëé∑ÂèñÊó∂Èó¥ËåÉÂõ¥ÊñáÊú¨
        function getTimeRangeText(timeRange) {
            const rangeMap = {
                '1': 'ÊúÄËøë1Â§©',
                '7': 'ÊúÄËøë1Âë®',
                '30': 'ÊúÄËøë1‰∏™Êúà',
                '90': 'ÊúÄËøë3‰∏™Êúà',
                '180': 'ÊúÄËøë6‰∏™Êúà',
                '365': 'ÊúÄËøë1Âπ¥',
                'all': 'ÊâÄÊúâÊó∂Èó¥'
            };
            return rangeMap[timeRange] || 'ÊâÄÊúâÊó∂Èó¥';
        }

        // Êô∫ËÉΩÊï¥ÁêÜÂØºÂá∫ÂäüËÉΩ
        function exportSmartSummary(moduleType) {
            const timeRangeSelect = document.getElementById(moduleType + 'TimeRange');
            const timeRange = timeRangeSelect ? timeRangeSelect.value : 'all';
            let data = [];
            
            switch(moduleType) {
                case 'plan':
                    data = growthData.plans;
                    break;
                case 'exercise':
                    data = growthData.exercises;
                    break;
                case 'study':
                    data = growthData.studies;
                    break;
                case 'reading':
                    data = growthData.readings;
                    break;
                case 'emotion':
                    data = growthData.emotions;
                    break;
            }
            
            // Â∫îÁî®Êó∂Èó¥ËåÉÂõ¥Á≠õÈÄâ
            if (timeRange !== 'all') {
                const days = parseInt(timeRange);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                data = data.filter(item => {
                    const itemDate = new Date(item.timestamp || item.date);
                    return itemDate >= cutoffDate;
                });
            }
            
            if (data.length === 0) {
                alert('ÊâÄÈÄâÊó∂Èó¥ËåÉÂõ¥ÂÜÖÊ≤°ÊúâÊï∞ÊçÆÔºÅ');
                return;
            }
            
            let summary = '';
            const timeRangeText = getTimeRangeText(timeRange);
            
            switch (moduleType) {
                case 'plan':
                    summary = generatePlanSummary(data, timeRangeText);
                    break;
                case 'exercise':
                    summary = generateExerciseSummary(data, timeRangeText);
                    break;
                case 'study':
                    summary = generateStudySummary(data, timeRangeText);
                    break;
                case 'reading':
                    summary = generateReadingSummary(data, timeRangeText);
                    break;
                case 'emotion':
                    summary = generateEmotionSummary(data, timeRangeText);
                    break;
            }
            
            const fileName = `${getModuleName(moduleType)}_Êô∫ËÉΩÊï¥ÁêÜ_${timeRangeText}_${new Date().toLocaleDateString().replace(/\//g, '-')}.txt`;
            downloadFile(summary, fileName, 'text/plain');
        }

        // ÁîüÊàêËÆ°ÂàíÊÄªÁªì
        function generatePlanSummary(data, timeRange) {
            let summary = `üìã ÊòéÊó•ËÆ°ÂàíÊô∫ËÉΩÊï¥ÁêÜÊä•Âëä (${timeRange})\n`;
            summary += `ÁîüÊàêÊó∂Èó¥Ôºö${new Date().toLocaleString()}\n`;
            summary += `Êï∞ÊçÆÊù°Êï∞Ôºö${data.length}Êù°\n\n`;
            
            summary += `üìä ËÆ°ÂàíÊ¶ÇËßàÔºö\n`;
            summary += `Âú®${timeRange}ÂÜÖÔºåÊÇ®ÂÖ±Âà∂ÂÆö‰∫Ü${data.length}Ê¨°ÊòéÊó•ËÆ°Âàí„ÄÇ\n\n`;
            
            if (data.length > 0) {
                let totalExpectedCompletion = 0;
                data.forEach(item => {
                    totalExpectedCompletion += item.expectedCompletion || 0;
                });
                const avgCompletion = (totalExpectedCompletion / data.length).toFixed(1);
                
                summary += `üìà ÂÆåÊàêÂ∫¶ÁªüËÆ°Ôºö\n`;
                summary += `Âπ≥ÂùáÈ¢ÑÊúüÂÆåÊàêÂ∫¶Ôºö${avgCompletion}/5\n\n`;
                
                summary += `üìù ËØ¶ÁªÜËÆ°ÂàíÂÜÖÂÆπÔºö\n`;
                data.forEach((item, index) => {
                    summary += `${index + 1}. „Äê${item.date}„Äë\n`;
                    summary += `   ‰∏ªË¶ÅÁõÆÊ†áÔºö${item.mainGoals || 'Êó†'}\n`;
                    summary += `   ËØ¶ÁªÜËÆ°ÂàíÔºö${item.detailPlan || 'Êó†'}\n`;
                    summary += `   È¢ÑÊúüÂÆåÊàêÂ∫¶Ôºö${item.expectedCompletion || 0}/5\n`;
                    summary += `   ÂàõÂª∫Êó∂Èó¥Ôºö${new Date(item.timestamp).toLocaleString()}\n\n`;
                });
            }
            
            return summary;
        }

        // ÁîüÊàêËøêÂä®ÊÄªÁªì
        function generateExerciseSummary(data, timeRange) {
            let summary = `üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®ËÆ∞ÂΩïÊô∫ËÉΩÊï¥ÁêÜÊä•Âëä (${timeRange})\n`;
            summary += `ÁîüÊàêÊó∂Èó¥Ôºö${new Date().toLocaleString()}\n`;
            summary += `Êï∞ÊçÆÊù°Êï∞Ôºö${data.length}Êù°\n\n`;
            
            if (data.length > 0) {
                const types = {};
                let totalDuration = 0;
                let totalIntensity = 0;
                
                data.forEach(item => {
                    const type = item.type || 'ÂÖ∂‰ªñËøêÂä®';
                    types[type] = (types[type] || 0) + 1;
                    totalDuration += parseInt(item.duration) || 0;
                    totalIntensity += parseInt(item.intensity) || 0;
                });
                
                summary += `üìä ËøêÂä®ÁªüËÆ°Ôºö\n`;
                summary += `ÊÄªËøêÂä®Ê¨°Êï∞Ôºö${data.length}Ê¨°\n`;
                summary += `ÊÄªËøêÂä®Êó∂ÈïøÔºö${totalDuration}ÂàÜÈíü\n`;
                summary += `Âπ≥ÂùáÊØèÊ¨°ËøêÂä®Ôºö${Math.round(totalDuration / data.length)}ÂàÜÈíü\n`;
                summary += `Âπ≥ÂùáËøêÂä®Âº∫Â∫¶Ôºö${(totalIntensity / data.length).toFixed(1)}/5\n\n`;
                
                summary += `üèÉ ËøêÂä®Á±ªÂûãÂàÜÂ∏ÉÔºö\n`;
                Object.entries(types).forEach(([type, count]) => {
                    summary += `${type}Ôºö${count}Ê¨°\n`;
                });
                summary += '\n';
                
                summary += `üìù ËØ¶ÁªÜËøêÂä®ËÆ∞ÂΩïÔºö\n`;
                data.forEach((item, index) => {
                    summary += `${index + 1}. „Äê${item.date}„Äë${item.type || 'ËøêÂä®'}\n`;
                    summary += `   Êó∂ÈïøÔºö${item.duration || 0}ÂàÜÈíü\n`;
                    summary += `   Âº∫Â∫¶Ôºö${item.intensity || 0}/5\n`;
                    summary += `   ÊÑüÂèóÔºö${item.feeling || 'Êó†'}\n`;
                    summary += `   ÂàõÂª∫Êó∂Èó¥Ôºö${new Date(item.timestamp).toLocaleString()}\n\n`;
                });
            }
            
            return summary;
        }

        // ÁîüÊàêÂ≠¶‰π†ÊÄªÁªì
        function generateStudySummary(data, timeRange) {
            let summary = `üìö Â≠¶‰π†ËÆ∞ÂΩïÊô∫ËÉΩÊï¥ÁêÜÊä•Âëä (${timeRange})\n`;
            summary += `ÁîüÊàêÊó∂Èó¥Ôºö${new Date().toLocaleString()}\n`;
            summary += `Êï∞ÊçÆÊù°Êï∞Ôºö${data.length}Êù°\n\n`;
            
            if (data.length > 0) {
                let totalDuration = 0;
                let totalMastery = 0;
                const topics = new Set();
                
                data.forEach(item => {
                    totalDuration += parseInt(item.totalDuration || item.duration) || 0;
                    totalMastery += parseInt(item.mastery) || 0;
                    if (item.topics && Array.isArray(item.topics)) {
                        item.topics.forEach(topic => topics.add(topic.name));
                    } else if (item.subject) {
                        topics.add(item.subject);
                    }
                });
                
                summary += `üìä Â≠¶‰π†ÁªüËÆ°Ôºö\n`;
                summary += `ÊÄªÂ≠¶‰π†Ê¨°Êï∞Ôºö${data.length}Ê¨°\n`;
                summary += `ÊÄªÂ≠¶‰π†Êó∂ÈïøÔºö${totalDuration}ÂàÜÈíü\n`;
                summary += `Âπ≥ÂùáÊØèÊ¨°Â≠¶‰π†Ôºö${Math.round(totalDuration / data.length)}ÂàÜÈíü\n`;
                summary += `Âπ≥ÂùáÊéåÊè°Â∫¶Ôºö${(totalMastery / data.length).toFixed(1)}/5\n`;
                summary += `Ê∂âÂèä‰∏ªÈ¢òÔºö${topics.size}‰∏™\n\n`;
                
                summary += `üìñ Â≠¶‰π†‰∏ªÈ¢òÔºö\n`;
                Array.from(topics).forEach((topic, index) => {
                    summary += `${index + 1}. ${topic}\n`;
                });
                summary += '\n';
                
                summary += `üìù ËØ¶ÁªÜÂ≠¶‰π†ËÆ∞ÂΩïÔºö\n`;
                data.forEach((item, index) => {
                    summary += `${index + 1}. „Äê${item.date}„Äë\n`;
                    summary += `   ‰∏ªÈ¢òÔºö${item.topics ? item.topics.map(t => t.name).join(', ') : (item.subject || 'Êó†')}\n`;
                    summary += `   Êó∂ÈïøÔºö${item.totalDuration || item.duration || 0}ÂàÜÈíü\n`;
                    summary += `   ÂÜÖÂÆπÔºö${item.content || 'Êó†'}\n`;
                    summary += `   ÊéåÊè°Â∫¶Ôºö${item.mastery || 0}/5\n`;
                    summary += `   Êî∂Ëé∑Ôºö${item.gains || 'Êó†'}\n`;
                    summary += `   ÂàõÂª∫Êó∂Èó¥Ôºö${new Date(item.timestamp).toLocaleString()}\n\n`;
                });
            }
            
            return summary;
        }

        // ÁîüÊàêÈòÖËØªÊÄªÁªì
        function generateReadingSummary(data, timeRange) {
            let summary = `üìñ ÈòÖËØªËÆ∞ÂΩïÊô∫ËÉΩÊï¥ÁêÜÊä•Âëä (${timeRange})\n`;
            summary += `ÁîüÊàêÊó∂Èó¥Ôºö${new Date().toLocaleString()}\n`;
            summary += `Êï∞ÊçÆÊù°Êï∞Ôºö${data.length}Êù°\n\n`;
            
            if (data.length > 0) {
                const books = new Set();
                let totalRating = 0;
                let ratingCount = 0;
                
                data.forEach(item => {
                    if (item.title) books.add(item.title);
                    if (item.rating) {
                        totalRating += parseInt(item.rating);
                        ratingCount++;
                    }
                });
                
                summary += `üìä ÈòÖËØªÁªüËÆ°Ôºö\n`;
                summary += `ÈòÖËØªËÆ∞ÂΩïÔºö${data.length}Êù°\n`;
                summary += `Ê∂âÂèä‰π¶Á±çÔºö${books.size}Êú¨\n`;
                if (ratingCount > 0) {
                    summary += `Âπ≥ÂùáÊé®ËçêÂ∫¶Ôºö${(totalRating / ratingCount).toFixed(1)}/5\n`;
                }
                summary += '\n';
                
                summary += `üìö ‰π¶Á±çÂàóË°®Ôºö\n`;
                Array.from(books).forEach((book, index) => {
                    summary += `${index + 1}. ${book}\n`;
                });
                summary += '\n';
                
                summary += `üìù ËØ¶ÁªÜÈòÖËØªËÆ∞ÂΩïÔºö\n`;
                data.forEach((item, index) => {
                    summary += `${index + 1}. „Äê${item.date}„Äë\n`;
                    summary += `   ‰π¶ÂêçÔºö${item.title || 'Êó†'}\n`;
                    summary += `   ËøõÂ∫¶Ôºö${item.progress || 'Êó†'}\n`;
                    summary += `   ÊÑüÊÇüÔºö${item.reflection || 'Êó†'}\n`;
                    summary += `   Êé®ËçêÂ∫¶Ôºö${item.rating || 0}/5\n`;
                    summary += `   ÂàõÂª∫Êó∂Èó¥Ôºö${new Date(item.timestamp).toLocaleString()}\n\n`;
                });
            }
            
            return summary;
        }

        // ÁîüÊàêÊÉÖÁª™ÊÄªÁªì
        function generateEmotionSummary(data, timeRange) {
            let summary = `üòä ÊÉÖÁª™ËÆ∞ÂΩïÊô∫ËÉΩÊï¥ÁêÜÊä•Âëä (${timeRange})\n`;
            summary += `ÁîüÊàêÊó∂Èó¥Ôºö${new Date().toLocaleString()}\n`;
            summary += `Êï∞ÊçÆÊù°Êï∞Ôºö${data.length}Êù°\n\n`;
            
            if (data.length > 0) {
                const emotions = {};
                const triggers = [];
                const regulations = [];
                let totalIntensity = 0;
                
                data.forEach(item => {
                    const emotion = item.emotion || 'Êú™ËÆ∞ÂΩï';
                    emotions[emotion] = (emotions[emotion] || 0) + 1;
                    if (item.trigger) triggers.push(item.trigger);
                    if (item.regulation) regulations.push(item.regulation);
                    totalIntensity += parseInt(item.intensity) || 0;
                });
                
                summary += `üìä ÊÉÖÁª™ÁªüËÆ°Ôºö\n`;
                summary += `ÊÉÖÁª™ËÆ∞ÂΩïÔºö${data.length}Êù°\n`;
                summary += `Âπ≥ÂùáÊÉÖÁª™Âº∫Â∫¶Ôºö${(totalIntensity / data.length).toFixed(1)}/5\n`;
                summary += `ÊÉÖÁª™Á±ªÂûãÂàÜÂ∏ÉÔºö\n`;
                Object.entries(emotions).forEach(([emotion, count]) => {
                    summary += `${emotion}Ôºö${count}Ê¨°\n`;
                });
                summary += '\n';
                
                if (triggers.length > 0) {
                    summary += `üéØ ‰∏ªË¶ÅÊÉÖÁª™Ëß¶Âèë‰∫ã‰ª∂Ôºö\n`;
                    triggers.slice(0, 5).forEach((trigger, index) => {
                        summary += `${index + 1}. ${trigger}\n`;
                    });
                    summary += '\n';
                }
                
                if (regulations.length > 0) {
                    summary += `üõ†Ô∏è ÊÉÖÁª™Ë∞ÉËäÇÊñπÊ≥ïÔºö\n`;
                    regulations.slice(0, 5).forEach((regulation, index) => {
                        summary += `${index + 1}. ${regulation}\n`;
                    });
                    summary += '\n';
                }
                
                summary += `üìù ËØ¶ÁªÜÊÉÖÁª™ËÆ∞ÂΩïÔºö\n`;
                data.forEach((item, index) => {
                    summary += `${index + 1}. „Äê${item.date}„ÄëÊÉÖÁª™Ôºö${item.emotion || 'Êú™ËÆ∞ÂΩï'}\n`;
                    summary += `   Âº∫Â∫¶Ôºö${item.intensity || 0}/5\n`;
                    summary += `   Ëß¶Âèë‰∫ã‰ª∂Ôºö${item.trigger || 'Êó†'}\n`;
                    summary += `   Ë∞ÉËäÇÊñπÊ≥ïÔºö${item.regulation || 'Êó†'}\n`;
                    summary += `   ÂàõÂª∫Êó∂Èó¥Ôºö${new Date(item.timestamp).toLocaleString()}\n\n`;
                });
            }
            
            return summary;
        }

        // ËΩ¨Êç¢‰∏∫CSVÊ†ºÂºè
        function convertToCSV(data, moduleType) {
            if (data.length === 0) return '';
            
            let headers = [];
            let rows = [];
            
            switch(moduleType) {
                case 'plan':
                    headers = ['Êó•Êúü', '‰∏ªË¶ÅÁõÆÊ†á', 'ËØ¶ÁªÜËÆ°Âàí', 'È¢ÑÊúüÂÆåÊàêÂ∫¶', 'ÂàõÂª∫Êó∂Èó¥'];
                    rows = data.map(item => [
                        item.date || '',
                        item.mainGoals || '',
                        item.detailPlan || '',
                        item.expectedCompletion || 0,
                        new Date(item.timestamp).toLocaleString()
                    ]);
                    break;
                case 'exercise':
                    headers = ['Êó•Êúü', 'ËøêÂä®Á±ªÂûã', 'Êó∂Èïø(ÂàÜÈíü)', 'Âº∫Â∫¶', 'ÊÑüÂèó', 'ÂàõÂª∫Êó∂Èó¥'];
                    rows = data.map(item => [
                        item.date || '',
                        item.type || '',
                        item.duration || 0,
                        item.intensity || 0,
                        item.feeling || '',
                        new Date(item.timestamp).toLocaleString()
                    ]);
                    break;
                case 'study':
                    headers = ['Êó•Êúü', 'Â≠¶‰π†‰∏ªÈ¢ò', 'ÊÄªÊó∂Èïø(ÂàÜÈíü)', 'Â≠¶‰π†ÂÜÖÂÆπ', 'ÊéåÊè°Â∫¶', 'Êî∂Ëé∑', 'ÂàõÂª∫Êó∂Èó¥'];
                    rows = data.map(item => [
                        item.date || '',
                        item.topics ? item.topics.map(t => t.name).join('; ') : (item.subject || ''),
                        item.totalDuration || item.duration || 0,
                        item.content || '',
                        item.mastery || 0,
                        item.gains || '',
                        new Date(item.timestamp).toLocaleString()
                    ]);
                    break;
                case 'reading':
                    headers = ['Êó•Êúü', '‰π¶Á±çÊ†áÈ¢ò', 'ÈòÖËØªËøõÂ∫¶', 'ÊÑüÊÇü', 'Êé®ËçêÂ∫¶', 'ÂàõÂª∫Êó∂Èó¥'];
                    rows = data.map(item => [
                        item.date || '',
                        item.title || '',
                        item.progress || '',
                        item.reflection || '',
                        item.rating || 0,
                        new Date(item.timestamp).toLocaleString()
                    ]);
                    break;
                case 'emotion':
                    headers = ['Êó•Êúü', 'ÊÉÖÁª™', 'Âº∫Â∫¶', 'Ëß¶Âèë‰∫ã‰ª∂', 'Ë∞ÉËäÇÊñπÊ≥ï', 'ÂàõÂª∫Êó∂Èó¥'];
                    rows = data.map(item => [
                        item.date || '',
                        item.emotion || '',
                        item.intensity || 0,
                        item.trigger || '',
                        item.regulation || '',
                        new Date(item.timestamp).toLocaleString()
                    ]);
                    break;
            }
            
            const csvContent = [headers.join(','), ...rows.map(row => row.map(cell => `"${cell}"`).join(','))].join('\n');
            return '\uFEFF' + csvContent; // Ê∑ªÂä†BOM‰ª•ÊîØÊåÅ‰∏≠Êñá
        }

        // ËΩ¨Êç¢‰∏∫TXTÊ†ºÂºè
        function convertToTXT(data, moduleType) {
            let content = '';
            
            switch(moduleType) {
                case 'plan':
                    content = '=== ËÆ°ÂàíÊï∞ÊçÆ ===\n\n';
                    data.forEach((item, index) => {
                        content += `${index + 1}. ËÆ°ÂàíËÆ∞ÂΩï\n`;
                        content += `   Êó•Êúü: ${item.date || ''}\n`;
                        content += `   ‰∏ªË¶ÅÁõÆÊ†á: ${item.mainGoals || ''}\n`;
                        content += `   ËØ¶ÁªÜËÆ°Âàí: ${item.detailPlan || ''}\n`;
                        content += `   È¢ÑÊúüÂÆåÊàêÂ∫¶: ${item.expectedCompletion || 0}/5\n`;
                        content += `   ÂàõÂª∫Êó∂Èó¥: ${new Date(item.timestamp).toLocaleString()}\n\n`;
                    });
                    break;
                case 'exercise':
                    content = '=== ËøêÂä®Êï∞ÊçÆ ===\n\n';
                    data.forEach((item, index) => {
                        content += `${index + 1}. ËøêÂä®ËÆ∞ÂΩï\n`;
                        content += `   Êó•Êúü: ${item.date || ''}\n`;
                        content += `   ËøêÂä®Á±ªÂûã: ${item.type || ''}\n`;
                        content += `   Êó∂Èïø: ${item.duration || 0}ÂàÜÈíü\n`;
                        content += `   Âº∫Â∫¶: ${item.intensity || 0}/5\n`;
                        content += `   ÊÑüÂèó: ${item.feeling || ''}\n`;
                        content += `   ÂàõÂª∫Êó∂Èó¥: ${new Date(item.timestamp).toLocaleString()}\n\n`;
                    });
                    break;
                case 'study':
                    content = '=== Â≠¶‰π†Êï∞ÊçÆ ===\n\n';
                    data.forEach((item, index) => {
                        content += `${index + 1}. Â≠¶‰π†ËÆ∞ÂΩï\n`;
                        content += `   Êó•Êúü: ${item.date || ''}\n`;
                        content += `   Â≠¶‰π†‰∏ªÈ¢ò: ${item.topics ? item.topics.map(t => t.name).join(', ') : (item.subject || '')}\n`;
                        content += `   ÊÄªÊó∂Èïø: ${item.totalDuration || item.duration || 0}ÂàÜÈíü\n`;
                        content += `   Â≠¶‰π†ÂÜÖÂÆπ: ${item.content || ''}\n`;
                        content += `   ÊéåÊè°Â∫¶: ${item.mastery || 0}/5\n`;
                        content += `   Êî∂Ëé∑: ${item.gains || ''}\n`;
                        content += `   ÂàõÂª∫Êó∂Èó¥: ${new Date(item.timestamp).toLocaleString()}\n\n`;
                    });
                    break;
                case 'reading':
                    content = '=== ÈòÖËØªÊï∞ÊçÆ ===\n\n';
                    data.forEach((item, index) => {
                        content += `${index + 1}. ÈòÖËØªËÆ∞ÂΩï\n`;
                        content += `   Êó•Êúü: ${item.date || ''}\n`;
                        content += `   ‰π¶Á±çÊ†áÈ¢ò: ${item.title || ''}\n`;
                        content += `   ÈòÖËØªËøõÂ∫¶: ${item.progress || ''}\n`;
                        content += `   ÊÑüÊÇü: ${item.reflection || ''}\n`;
                        content += `   Êé®ËçêÂ∫¶: ${item.rating || 0}/5\n`;
                        content += `   ÂàõÂª∫Êó∂Èó¥: ${new Date(item.timestamp).toLocaleString()}\n\n`;
                    });
                    break;
                case 'emotion':
                    content = '=== ÊÉÖÁª™Êï∞ÊçÆ ===\n\n';
                    data.forEach((item, index) => {
                        content += `${index + 1}. ÊÉÖÁª™ËÆ∞ÂΩï\n`;
                        content += `   Êó•Êúü: ${item.date || ''}\n`;
                        content += `   ÊÉÖÁª™: ${item.emotion || ''}\n`;
                        content += `   Âº∫Â∫¶: ${item.intensity || 0}/5\n`;
                        content += `   Ëß¶Âèë‰∫ã‰ª∂: ${item.trigger || ''}\n`;
                        content += `   Ë∞ÉËäÇÊñπÊ≥ï: ${item.regulation || ''}\n`;
                        content += `   ÂàõÂª∫Êó∂Èó¥: ${new Date(item.timestamp).toLocaleString()}\n\n`;
                    });
                    break;
            }
            
            return content;
        }

        // ÂØºÂá∫Ê®°Âùó‰∏∫ÂõæÁâá
        function exportModuleAsImage(moduleType) {
            const moduleElement = document.getElementById(moduleType);
            if (!moduleElement) {
                alert('Ê®°Âùó‰∏çÂ≠òÂú®ÔºÅ');
                return;
            }
            
            // ‰ΩøÁî®html2canvasÂØºÂá∫Ê®°Âùó‰∏∫ÂõæÁâá
            html2canvas(moduleElement, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: false,
                foreignObjectRendering: false,
                logging: false,
                width: moduleElement.scrollWidth,
                height: moduleElement.scrollHeight
            }).then(canvas => {
                const link = document.createElement('a');
                const dateStr = new Date().toLocaleDateString().replace(/\//g, '-');
                link.download = `${getModuleName(moduleType)}_${dateStr}.png`;
                link.href = canvas.toDataURL();
                link.click();
                alert(`${getModuleName(moduleType)}Â∑≤ÂØºÂá∫‰∏∫ÂõæÁâáÔºÅ`);
            }).catch(error => {
                console.error('ÂØºÂá∫Â§±Ë¥•:', error);
                alert('ÂØºÂá∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ');
            });
        }

        // Ëé∑ÂèñÊ®°Âùó‰∏≠ÊñáÂêçÁß∞
        function getModuleName(moduleType) {
            const names = {
                'plan': 'ËÆ°ÂàíÊ®°Âùó',
                'exercise': 'ËøêÂä®Ê®°Âùó',
                'study': 'Â≠¶‰π†Ê®°Âùó',
                'reading': 'ÈòÖËØªÊ®°Âùó',
                'emotion': 'ÊÉÖÁª™Ê®°Âùó'
            };
            return names[moduleType] || moduleType;
        }

        // ‰∏ãËΩΩÊñá‰ª∂Âà∞ÈªòËÆ§‰∏ãËΩΩÁõÆÂΩï
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            alert(`${filename} Â∑≤ÊàêÂäüÂØºÂá∫Âà∞‰∏ãËΩΩÊñá‰ª∂Â§πÔºÅ`);
        }

        // Áî®Êà∑ÂßìÂêçÁÆ°ÁêÜ
        function initializeUserName() {
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                document.getElementById('userNameDisplay').textContent = savedName + 'ÁöÑ';
                document.getElementById('userName').value = savedName;
            }
        }

        function updateUserName() {
            const nameInput = document.getElementById('userName');
            const name = nameInput.value.trim();
            
            if (name) {
                document.getElementById('userNameDisplay').textContent = name + 'ÁöÑ';
                localStorage.setItem('userName', name);
                alert('ÂßìÂêçÂ∑≤Êõ¥Êñ∞ÔºÅ');
                // Êõ¥Êñ∞ÂêéËá™Âä®ÈöêËóèËæìÂÖ•Ê°Ü
                document.getElementById('userNameSection').style.display = 'none';
            } else {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÂßìÂêçÔºÅ');
            }
        }

        // ÂàáÊç¢Áî®Êà∑ÂßìÂêçËæìÂÖ•Ê°ÜÁöÑÊòæÁ§∫/ÈöêËóè
        function toggleUserNameSection() {
            const section = document.getElementById('userNameSection');
            if (section.style.display === 'none') {
                section.style.display = 'block';
                // ËÅöÁÑ¶Âà∞ËæìÂÖ•Ê°Ü
                document.getElementById('userName').focus();
            } else {
                section.style.display = 'none';
            }
        }

        // ÊØèÊó•Âä±ÂøóËØ≠ÂΩï
        const dailyQuotes = [
            "‰ªäÂ§©ÁöÑÂä™ÂäõÔºåÊòØÊòéÂ§©ÊàêÂäüÁöÑÂü∫Áü≥„ÄÇ",
            "ÊØè‰∏ÄÊ¨°ËøõÊ≠•ÔºåÈÉΩÊòØÂØπÊò®Â§©ÁöÑË∂ÖË∂ä„ÄÇ",
            "ÊàêÈïø‰∏çÊòØ‰∏ÄËπ¥ËÄåÂ∞±ÔºåËÄåÊòØÊó•ÁßØÊúàÁ¥ØÁöÑÂùöÊåÅ„ÄÇ",
            "Áõ∏‰ø°Ëá™Â∑±Ôºå‰Ω†ÊØîÊÉ≥Ë±°‰∏≠Êõ¥Âº∫Â§ß„ÄÇ",
            "Âõ∞ÈöæÊòØÊàêÈïøË∑Ø‰∏äÁöÑÂû´ËÑöÁü≥ÔºåËÄåÈùûÁªäËÑöÁü≥„ÄÇ",
            "‰ªäÂ§©ÁöÑ‰Ω†ÔºåË¶ÅÊØîÊò®Â§©ÁöÑ‰Ω†Êõ¥‰ºòÁßÄ‰∏ÄÁÇπÁÇπ„ÄÇ",
            "Ê¢¶ÊÉ≥‰∏ç‰ºöÈÄÉË∑ëÔºå‰ºöÈÄÉË∑ëÁöÑÊ∞∏ËøúÈÉΩÊòØËá™Â∑±„ÄÇ",
            "ÊØè‰∏Ä‰∏™‰∏çÊõæËµ∑ËàûÁöÑÊó•Â≠êÔºåÈÉΩÊòØÂØπÁîüÂëΩÁöÑËæúË¥ü„ÄÇ",
            "ÊàêÂäüÁöÑÁßòËØÄÂú®‰∫éÂùöÊåÅËá™Â∑±ÁöÑÊ¢¶ÊÉ≥„ÄÇ",
            "Ë∑ØËôΩËøúÔºåË°åÂàôÂ∞ÜËá≥Ôºõ‰∫ãËôΩÈöæÔºåÂÅöÂàôÂøÖÊàê„ÄÇ",
            "‰∏çË¶ÅÁ≠âÂæÖÊú∫‰ºöÔºåËÄåË¶ÅÂàõÈÄ†Êú∫‰ºö„ÄÇ",
            "‰ªäÂ§©ÁöÑÊ±óÊ∞¥ÔºåÊòØÊòéÂ§©ÂæÆÁ¨ëÁöÑÁêÜÁî±„ÄÇ",
            "ÊØè‰∏ÄÊ¨°Êå´ÊäòÔºåÈÉΩÊòØÊàêÈïøÁöÑÊú∫‰ºö„ÄÇ",
            "‰øùÊåÅÂàùÂøÉÔºåÊñπÂæóÂßãÁªà„ÄÇ",
            "Âä™Âäõ‰∏ç‰∏ÄÂÆöÊàêÂäüÔºå‰ΩÜÊîæÂºÉ‰∏ÄÂÆöÂ§±Ë¥•„ÄÇ",
            "Êó∂Èó¥‰ºöËØÅÊòéÔºåÊâÄÊúâÁöÑÂä™ÂäõÈÉΩ‰∏ç‰ºöÁôΩË¥π„ÄÇ",
            "ÊàêÈïøÁöÑË∑Ø‰∏äÔºåÊÑüË∞¢ÊØè‰∏Ä‰∏™ÂùöÊåÅÁöÑËá™Â∑±„ÄÇ",
            "‰ªäÂ§©ÁöÑÈÄâÊã©ÔºåÂÜ≥ÂÆöÊòéÂ§©ÁöÑ‰Ω†„ÄÇ",
            "ÂãáÊï¢Èù¢ÂØπÊåëÊàòÔºå‰Ω†‰ºöÂèëÁé∞Ëá™Â∑±ÁöÑÊó†ÈôêÂèØËÉΩ„ÄÇ",
            "ÊØè‰∏ÄÂ§©ÈÉΩÊòØÊñ∞ÁöÑÂºÄÂßãÔºåÊØè‰∏ÄÂàªÈÉΩÂÖÖÊª°Â∏åÊúõ„ÄÇ",
            "ÊàêÂäü‰∏çÊòØÁªàÁÇπÔºåËÄåÊòØ‰∏çÊñ≠ÂâçËøõÁöÑËøáÁ®ã„ÄÇ",
            "Áõ∏‰ø°ËøáÁ®ãÔºå‰∫´ÂèóÊàêÈïøÁöÑÊØè‰∏Ä‰∏™Áû¨Èó¥„ÄÇ",
            "‰ªäÂ§©ÁöÑÂ≠¶‰π†ÔºåÊòØÊòéÂ§©Êô∫ÊÖßÁöÑÁßØÁ¥Ø„ÄÇ",
            "ÂùöÊåÅÂÅöÂØπÁöÑ‰∫ãÔºåÊó∂Èó¥‰ºöÁªô‰Ω†ÊúÄÂ•ΩÁöÑÁ≠îÊ°à„ÄÇ",
            "ÊØè‰∏ÄÊ¨°Âä™ÂäõÔºåÈÉΩËÆ©‰Ω†Á¶ªÊ¢¶ÊÉ≥Êõ¥Ëøë‰∏ÄÊ≠•„ÄÇ",
            "ÊàêÈïøÁöÑÊÑè‰πâÔºåÂú®‰∫éÊàê‰∏∫Êõ¥Â•ΩÁöÑËá™Â∑±„ÄÇ",
            "‰ªäÂ§©ÁöÑ‰ªòÂá∫ÔºåÊòØÂØπÊú™Êù•ÊúÄÂ•ΩÁöÑÊäïËµÑ„ÄÇ",
            "‰øùÊåÅÂ•ΩÂ•áÂøÉÔºå‰∏ñÁïå‰ºö‰∏∫‰Ω†Â±ïÁé∞Êõ¥Â§öÁ≤æÂΩ©„ÄÇ",
            "ÊØè‰∏Ä‰∏™ÂæÆÂ∞èÁöÑËøõÊ≠•ÔºåÈÉΩÂÄºÂæóË¢´Â∫ÜÁ•ù„ÄÇ",
            "ÂãáÊï¢ËøΩÊ±ÇÊ¢¶ÊÉ≥ÔºåËÆ©ÁîüÂëΩÁªΩÊîæÂÖâÂΩ©„ÄÇ"
        ];

        function updateDailyQuote() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const quoteIndex = dayOfYear % dailyQuotes.length;
            
            document.getElementById('dailyQuote').textContent = dailyQuotes[quoteIndex];
        }

        // ÂõæÁâáÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
        function openImageModal(imageId, module) {
            console.log('openImageModal called with:', imageId, module); // Ë∞ÉËØïÊó•Âøó
            
            // ‰ΩøÁî®Áªü‰∏ÄÁöÑÊï∞ÊçÆËé∑ÂèñÊñπÂºè
            const moduleImages = getModuleImages(module);
            console.log('moduleImages:', moduleImages); // Ë∞ÉËØïÊó•Âøó
            
            const imageInfo = moduleImages[imageId];
            console.log('imageInfo:', imageInfo); // Ë∞ÉËØïÊó•Âøó
            
            if (!imageInfo) {
                console.error('Image not found:', imageId, module);
                return;
            }

            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalDescription = document.getElementById('modalDescription');
            const modalTags = document.getElementById('modalTags');
            const modalTimestamp = document.getElementById('modalTimestamp');

            if (!modal || !modalImage || !modalDescription || !modalTags || !modalTimestamp) {
                console.error('Modal elements not found');
                return;
            }

            modalImage.src = imageInfo.url;
            modalDescription.value = imageInfo.description || '';
            modalTags.value = imageInfo.tags ? imageInfo.tags.join(', ') : '';
            modalTimestamp.textContent = new Date(imageInfo.timestamp).toLocaleString('zh-CN');

            // Â≠òÂÇ®ÂΩìÂâçÁºñËæëÁöÑÂõæÁâá‰ø°ÊÅØ
            modalImage.dataset.imageId = imageId;
            modalImage.dataset.module = module;

            // Âä†ËΩΩÂΩìÂâçÂõæÁâáÁöÑÊ†áÁ≠æÂà∞Ê†áÁ≠æÁ≥ªÁªü
            currentImageTags = imageInfo && imageInfo.tags ? [...imageInfo.tags] : [];
            updateCurrentTagsDisplay();
            updatePopularTags();

            modal.style.display = 'block';
            console.log('Modal should be visible now'); // Ë∞ÉËØïÊó•Âøó
        }

        function closeImageModal() {
            document.getElementById('imageModal').style.display = 'none';
            // Ê∏ÖÁ©∫ÂΩìÂâçÊ†áÁ≠æ
            currentImageTags = [];
        }

        function saveImageInfo() {
            const modalImage = document.getElementById('modalImage');
            const imageId = modalImage.dataset.imageId;
            const module = modalImage.dataset.module;
            const description = document.getElementById('modalDescription').value;
            
            if (imageId && module) {
                // Áõ¥Êé•Êõ¥Êñ∞imageDataÂØπË±°
                if (imageData[module] && imageData[module][imageId]) {
                    imageData[module][imageId].description = description;
                    imageData[module][imageId].tags = [...currentImageTags];
                    
                    // ‰øùÂ≠òÂà∞localStorage - ‰ΩøÁî®Áªü‰∏ÄÁöÑimageDataÈîÆ
                    localStorage.setItem('imageData', JSON.stringify(imageData));
                    
                    // Êõ¥Êñ∞ÂÖ®Â±ÄÊ†áÁ≠æÈõÜÂêà
                    currentImageTags.forEach(tag => allTags.add(tag));
                    
                    // Âà∑Êñ∞ÊòæÁ§∫
                    const previewContainer = document.getElementById(`${module}-image-preview`);
                    if (previewContainer) {
                        displayStoredImages(module, previewContainer);
                    }
                    
                    // Â¶ÇÊûúÊó∂Èó¥ËΩ¥È°µÈù¢ÊâìÂºÄÔºå‰πüÂà∑Êñ∞Êó∂Èó¥ËΩ¥
                    if (document.getElementById('timeline').style.display !== 'none') {
                        loadTimeline();
                        loadTagManagement();
                    }
                    
                    closeImageModal();
                }
            }
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target === modal) {
                closeImageModal();
            }
        }

        // Êó∂Èó¥ËΩ¥Áõ∏ÂÖ≥ÂáΩÊï∞
        function loadTimeline() {
            const timelineContent = document.getElementById('timelineContent');
            const allImages = getAllImagesWithTimestamp();
            
            if (allImages.length === 0) {
                timelineContent.innerHTML = `
                    <div class="timeline-empty">
                        <div class="empty-icon">üì∑</div>
                        <h3>ËøòÊ≤°ÊúâÂõæÁâáËÆ∞ÂΩï</h3>
                        <p>ÂºÄÂßãÂú®ÂêÑ‰∏™Ê®°Âùó‰∏≠‰∏ä‰º†ÂõæÁâáÔºåËÆ∞ÂΩï‰Ω†ÁöÑÊàêÈïøÂéÜÁ®ãÂêßÔºÅ</p>
                    </div>
                `;
                updateTimelineStats(0, 0);
                return;
            }

            // ÊåâÊó•ÊúüÂàÜÁªÑ
            const groupedImages = groupImagesByDate(allImages);
            
            // ÁîüÊàêÊó∂Èó¥ËΩ¥HTML
            let timelineHTML = '';
            Object.keys(groupedImages).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
                const images = groupedImages[date];
                const dateObj = new Date(date);
                const dayOfMonth = dateObj.getDate();
                const monthDay = `${dateObj.getMonth() + 1}/${dayOfMonth}`;
                
                timelineHTML += `
                    <div class="timeline-item">
                        <div class="timeline-date">
                            <div class="timeline-date-circle">${dayOfMonth}</div>
                            <div class="timeline-date-text">${monthDay}</div>
                        </div>
                        <div class="timeline-content-wrapper">
                            <div class="timeline-images">
                                ${images.map(img => `
                                    <div class="timeline-image-item" onclick="openImageModal('${img.id}', '${img.module}')">
                                        <img src="${img.url}" alt="${img.name}">
                                        <div class="timeline-image-overlay">
                                            <div class="timeline-image-module">${getModuleDisplayName(img.module)}</div>
                                            <div class="timeline-image-desc">${img.description || 'ÁÇπÂáªÊ∑ªÂä†ÊèèËø∞'}</div>
                                            ${img.tags && img.tags.length > 0 ? `
                                                <div class="timeline-image-tags">
                                                    ${img.tags.map(tag => `<span class="timeline-tag">${tag}</span>`).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            timelineContent.innerHTML = timelineHTML;
            updateTimelineStats(allImages.length, allImages.length);
        }

        function getAllImagesWithTimestamp() {
            const allImages = [];
            const modules = ['plan', 'exercise', 'study', 'reading', 'emotion'];
            
            modules.forEach(module => {
                const moduleImages = getModuleImages(module);
                Object.entries(moduleImages).forEach(([id, imageData]) => {
                    allImages.push({
                        id: id,
                        module: module,
                        url: imageData.url,
                        name: imageData.name,
                        timestamp: imageData.timestamp || Date.now(),
                        description: imageData.description || '',
                        tags: imageData.tags || []
                    });
                });
            });
            
            return allImages.sort((a, b) => b.timestamp - a.timestamp);
        }

        function groupImagesByDate(images) {
            const grouped = {};
            images.forEach(img => {
                const date = new Date(img.timestamp).toDateString();
                if (!grouped[date]) {
                    grouped[date] = [];
                }
                grouped[date].push(img);
            });
            return grouped;
        }

        function getModuleDisplayName(module) {
            const names = {
                plan: 'üìÖ ËÆ°Âàí',
                exercise: 'üèÉ‚Äç‚ôÇÔ∏è ËøêÂä®',
                study: 'üìö Â≠¶‰π†',
                reading: 'üìñ ÈòÖËØª',
                emotion: 'üòä ÊÉÖÁª™'
            };
            return names[module] || module;
        }

        function filterTimeline() {
            const timeRange = document.getElementById('timelineRange').value;
            const moduleFilter = document.getElementById('moduleFilter').value;
            const tagSearch = document.getElementById('tagSearch').value.toLowerCase();
            
            let allImages = getAllImagesWithTimestamp();
            
            // Êó∂Èó¥ËåÉÂõ¥Á≠õÈÄâ
            if (timeRange !== 'all') {
                const days = parseInt(timeRange);
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                allImages = allImages.filter(img => new Date(img.timestamp) >= cutoffDate);
            }
            
            // Ê®°ÂùóÁ≠õÈÄâ
            if (moduleFilter !== 'all') {
                allImages = allImages.filter(img => img.module === moduleFilter);
            }
            
            // Ê†áÁ≠æÊêúÁ¥¢
            if (tagSearch) {
                allImages = allImages.filter(img => {
                    const description = (img.description || '').toLowerCase();
                    const tags = (img.tags || []).join(' ').toLowerCase();
                    return description.includes(tagSearch) || tags.includes(tagSearch);
                });
            }
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            const timelineContent = document.getElementById('timelineContent');
            if (allImages.length === 0) {
                timelineContent.innerHTML = `
                    <div class="timeline-empty">
                        <div class="empty-icon">üîç</div>
                        <h3>Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÂõæÁâá</h3>
                        <p>Â∞ùËØïË∞ÉÊï¥Á≠õÈÄâÊù°‰ª∂ÊàñÊêúÁ¥¢ÂÖ≥ÈîÆËØç</p>
                    </div>
                `;
                updateTimelineStats(getAllImagesWithTimestamp().length, 0);
                return;
            }
            
            // ÊåâÊó•ÊúüÂàÜÁªÑÂπ∂ÊòæÁ§∫
            const groupedImages = groupImagesByDate(allImages);
            let timelineHTML = '';
            Object.keys(groupedImages).sort((a, b) => new Date(b) - new Date(a)).forEach(date => {
                const images = groupedImages[date];
                const dateObj = new Date(date);
                const dayOfMonth = dateObj.getDate();
                const monthDay = `${dateObj.getMonth() + 1}/${dayOfMonth}`;
                
                timelineHTML += `
                    <div class="timeline-item">
                        <div class="timeline-date">
                            <div class="timeline-date-circle">${dayOfMonth}</div>
                            <div class="timeline-date-text">${monthDay}</div>
                        </div>
                        <div class="timeline-content-wrapper">
                            <div class="timeline-images">
                                ${images.map(img => `
                                    <div class="timeline-image-item" onclick="openImageModal('${img.id}', '${img.module}')">
                                        <img src="${img.url}" alt="${img.name}">
                                        <div class="timeline-image-overlay">
                                            <div class="timeline-image-module">${getModuleDisplayName(img.module)}</div>
                                            <div class="timeline-image-desc">${img.description || 'ÁÇπÂáªÊ∑ªÂä†ÊèèËø∞'}</div>
                                            ${img.tags && img.tags.length > 0 ? `
                                                <div class="timeline-image-tags">
                                                    ${img.tags.map(tag => `<span class="timeline-tag">${tag}</span>`).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            timelineContent.innerHTML = timelineHTML;
            updateTimelineStats(getAllImagesWithTimestamp().length, allImages.length);
        }

        function updateTimelineStats(total, filtered) {
            document.getElementById('totalImages').textContent = total;
            document.getElementById('filteredImages').textContent = filtered;
        }

        // ‰øÆÊîπshowModuleÂáΩÊï∞‰ª•ÊîØÊåÅÊó∂Èó¥ËΩ¥ÂíåÊï∞ÊçÆÈù¢Êùø
        const originalShowModule = showModule;

        // Ê†áÁ≠æÁ≥ªÁªüÁõ∏ÂÖ≥ÂáΩÊï∞
        let currentImageTags = [];
        let allTags = new Set();

        function initTagSystem() {
            const tagInput = document.getElementById('modalTags');
            if (tagInput) {
                tagInput.addEventListener('keydown', handleTagInput);
                tagInput.addEventListener('input', showTagSuggestions);
                tagInput.addEventListener('blur', hideTagSuggestions);
            }
            loadAllTags();
        }

        function handleTagInput(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const tagValue = event.target.value.trim();
                if (tagValue && !currentImageTags.includes(tagValue)) {
                    addTag(tagValue);
                    event.target.value = '';
                    hideTagSuggestions();
                }
            }
        }

        function addTag(tagName) {
            if (!currentImageTags.includes(tagName)) {
                currentImageTags.push(tagName);
                allTags.add(tagName);
                updateCurrentTagsDisplay();
                updatePopularTags();
            }
        }

        function removeTag(tagName) {
            const index = currentImageTags.indexOf(tagName);
            if (index > -1) {
                currentImageTags.splice(index, 1);
                updateCurrentTagsDisplay();
            }
        }

        function updateCurrentTagsDisplay() {
            const container = document.getElementById('currentTags');
            if (!container) return;
            
            container.innerHTML = currentImageTags.map(tag => `
                <span class="tag-item">
                    ${tag}
                    <span class="tag-remove" onclick="removeTag('${tag}')">&times;</span>
                </span>
            `).join('');
        }

        function showTagSuggestions(event) {
            const input = event.target.value.toLowerCase();
            if (input.length < 1) {
                hideTagSuggestions();
                return;
            }

            const suggestions = Array.from(allTags).filter(tag => 
                tag.toLowerCase().includes(input) && !currentImageTags.includes(tag)
            );

            const suggestionsContainer = document.getElementById('tagSuggestions');
            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.slice(0, 5).map(tag => `
                    <div class="tag-suggestion-item" onclick="selectSuggestion('${tag}')">${tag}</div>
                `).join('');
                suggestionsContainer.style.display = 'block';
            } else {
                hideTagSuggestions();
            }
        }

        function selectSuggestion(tagName) {
            addTag(tagName);
            document.getElementById('modalTags').value = '';
            hideTagSuggestions();
        }

        function hideTagSuggestions() {
            setTimeout(() => {
                const suggestionsContainer = document.getElementById('tagSuggestions');
                if (suggestionsContainer) {
                    suggestionsContainer.style.display = 'none';
                }
            }, 200);
        }

        function loadAllTags() {
            const modules = ['plan', 'exercise', 'study', 'reading', 'emotion'];
            allTags.clear();
            
            modules.forEach(module => {
                const moduleImages = getModuleImages(module);
                Object.values(moduleImages).forEach(imageData => {
                    if (imageData.tags && Array.isArray(imageData.tags)) {
                        imageData.tags.forEach(tag => allTags.add(tag));
                    }
                });
            });
            
            updatePopularTags();
        }

        function updatePopularTags() {
            const tagCounts = getTagCounts();
            const popularTagsContainer = document.getElementById('popularTags');
            if (!popularTagsContainer) return;
            
            const sortedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            popularTagsContainer.innerHTML = sortedTags.map(([tag, count]) => `
                <span class="popular-tag" onclick="addTag('${tag}')">${tag} (${count})</span>
            `).join('');
        }

        function getTagCounts() {
            const tagCounts = {};
            const modules = ['plan', 'exercise', 'study', 'reading', 'emotion'];
            
            modules.forEach(module => {
                const moduleImages = getModuleImages(module);
                Object.values(moduleImages).forEach(imageData => {
                    if (imageData.tags && Array.isArray(imageData.tags)) {
                        imageData.tags.forEach(tag => {
                            tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                        });
                    }
                });
            });
            
            return tagCounts;
        }

        function loadTagManagement() {
            const tagCounts = getTagCounts();
            const totalTags = Object.keys(tagCounts).length;
            const taggedImages = getAllImagesWithTimestamp().filter(img => img.tags && img.tags.length > 0).length;
            const mostUsedCount = Math.max(...Object.values(tagCounts), 0);
            
            // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
            document.getElementById('totalTagsCount').textContent = totalTags;
            document.getElementById('taggedImagesCount').textContent = taggedImages;
            document.getElementById('mostUsedTagCount').textContent = mostUsedCount;
            
            // ÁîüÊàêÊ†áÁ≠æ‰∫ë
            const tagCloud = document.getElementById('tagCloud');
            const sortedTags = Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            tagCloud.innerHTML = sortedTags.map(([tag, count]) => `
                <div class="tag-cloud-item" onclick="filterByTag('${tag}')">
                    ${tag}
                    <span class="tag-count">${count}</span>
                </div>
            `).join('');
        }

        function filterByTag(tagName) {
            document.getElementById('tagSearch').value = tagName;
            filterTimeline();
        }

        // ‰øÆÊîπopenImageModalÂáΩÊï∞‰ª•ÊîØÊåÅÊ†áÁ≠æÁ≥ªÁªü
        // Â∑≤ÁªèÂú®‰∏äÈù¢ÁöÑopenImageModalÂáΩÊï∞‰∏≠ÈõÜÊàê‰∫ÜÊ†áÁ≠æÁ≥ªÁªüÊîØÊåÅ

        // ‰øÆÊîπsaveImageInfoÂáΩÊï∞‰ª•‰øùÂ≠òÊ†áÁ≠æ
        // Â∑≤ÁªèÂú®‰∏äÈù¢ÁöÑsaveImageInfoÂáΩÊï∞‰∏≠ÈõÜÊàê‰∫ÜÊ†áÁ≠æ‰øùÂ≠òÂäüËÉΩ

        // ÂõæÁâáÁªüËÆ°Èù¢ÊùøÂäüËÉΩ
        function loadImageStats() {
            const allImages = getAllImagesWithTimestamp();
            
            // Êõ¥Êñ∞Âü∫Á°ÄÁªüËÆ°
            updateBasicImageStats(allImages);
            
            // Êõ¥Êñ∞ÂõæÁâáÂ¢ûÈïøÁªüËÆ°Èù¢Êùø
            updateImageGrowthPanel(allImages);
        }

        function updateBasicImageStats(allImages) {
            const totalImages = allImages.length;
            const allTags = new Set();
            
            allImages.forEach(img => {
                if (img.tags) {
                    img.tags.forEach(tag => allTags.add(tag));
                }
            });

            // ËÆ°ÁÆóÊú¨ÊúàÊñ∞Â¢ûÂõæÁâá
            const now = new Date();
            const currentMonth = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
            const monthlyImages = allImages.filter(img => {
                const imgDate = new Date(img.timestamp);
                const imgMonth = imgDate.getFullYear() + '-' + String(imgDate.getMonth() + 1).padStart(2, '0');
                return imgMonth === currentMonth;
            }).length;

            // Êõ¥Êñ∞ÁªüËÆ°Âç°Áâá
            const imageCountElement = document.querySelector('.stat-card:nth-child(4) .stat-number');
            const tagCountElement = document.querySelector('.stat-card:nth-child(5) .stat-number');
            const monthlyCountElement = document.querySelector('.stat-card:nth-child(6) .stat-number');

            if (imageCountElement) imageCountElement.textContent = totalImages;
            if (tagCountElement) tagCountElement.textContent = allTags.size;
            if (monthlyCountElement) monthlyCountElement.textContent = monthlyImages;
        }

        function updateImageGrowthPanel(allImages) {
            updateModuleDistribution(allImages);
            updateMonthlyTrend(allImages);
            updateTopTags(allImages);
            updateTimeDistribution(allImages);
        }

        function updateModuleDistribution(allImages) {
            const moduleStats = {};
            
            allImages.forEach(img => {
                const module = img.module || 'unknown';
                moduleStats[module] = (moduleStats[module] || 0) + 1;
            });

            const container = document.querySelector('.module-distribution');
            if (!container) return;

            container.innerHTML = '';
            
            Object.entries(moduleStats)
                .sort((a, b) => b[1] - a[1])
                .forEach(([module, count]) => {
                    const item = document.createElement('div');
                    item.className = 'module-item';
                    item.innerHTML = `
                        <span class="module-name">${getModuleDisplayName(module)}</span>
                        <span class="module-count">${count}</span>
                    `;
                    container.appendChild(item);
                });
        }

        function updateMonthlyTrend(allImages) {
            const monthlyStats = {};
            
            allImages.forEach(img => {
                const date = new Date(img.timestamp);
                const monthKey = date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0');
                monthlyStats[monthKey] = (monthlyStats[monthKey] || 0) + 1;
            });

            const container = document.querySelector('.monthly-trend');
            if (!container) return;

            container.innerHTML = '';
            
            // Ëé∑ÂèñÊúÄËøë6‰∏™ÊúàÁöÑÊï∞ÊçÆ
            const months = Object.keys(monthlyStats).sort().slice(-6);
            
            months.forEach(month => {
                const item = document.createElement('div');
                item.className = 'trend-item';
                const [year, monthNum] = month.split('-');
                const monthName = new Date(year, monthNum - 1).toLocaleDateString('zh-CN', { month: 'short' });
                
                item.innerHTML = `
                    <span class="trend-month">${monthName}</span>
                    <span class="trend-count">${monthlyStats[month]}</span>
                `;
                container.appendChild(item);
            });
        }

        function updateTopTags(allImages) {
            const tagCounts = getTagCounts(allImages);
            const container = document.querySelector('.top-tags-list');
            if (!container) return;

            container.innerHTML = '';
            
            Object.entries(tagCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10)
                .forEach(([tag, count]) => {
                    const item = document.createElement('div');
                    item.className = 'top-tag-item';
                    item.onclick = () => filterByTag(tag);
                    item.innerHTML = `
                        <span class="tag-name">${tag}</span>
                        <span class="tag-usage-count">${count}</span>
                    `;
                    container.appendChild(item);
                });
        }

        function updateTimeDistribution(allImages) {
            const timeSlots = {
                'Êó©Êô® (6-12)': 0,
                '‰∏ãÂçà (12-18)': 0,
                'Êôö‰∏ä (18-24)': 0,
                'Ê∑±Â§ú (0-6)': 0
            };

            allImages.forEach(img => {
                const hour = new Date(img.timestamp).getHours();
                if (hour >= 6 && hour < 12) {
                    timeSlots['Êó©Êô® (6-12)']++;
                } else if (hour >= 12 && hour < 18) {
                    timeSlots['‰∏ãÂçà (12-18)']++;
                } else if (hour >= 18 && hour < 24) {
                    timeSlots['Êôö‰∏ä (18-24)']++;
                } else {
                    timeSlots['Ê∑±Â§ú (0-6)']++;
                }
            });

            const container = document.querySelector('.time-distribution');
            if (!container) return;

            container.innerHTML = '';
            
            Object.entries(timeSlots).forEach(([timeLabel, count]) => {
                const slot = document.createElement('div');
                slot.className = 'time-slot';
                slot.innerHTML = `
                    <div class="time-label">${timeLabel}</div>
                    <div class="time-count">${count}</div>
                `;
                container.appendChild(slot);
            });
        }

        // ‰øÆÊîπshowModuleÂáΩÊï∞ÔºåÊ∑ªÂä†Êï∞ÊçÆÈù¢ÊùøÁöÑÂõæÁâáÁªüËÆ°Âä†ËΩΩ
        showModule = function(module) {
            originalShowModule(module);
            
            if (module === 'timeline') {
                setTimeout(() => {
                    loadTimeline();
                    loadTagManagement();
                }, 100);
            } else if (module === 'data') {
                setTimeout(() => {
                    loadImageStats();
                }, 100);
            }
        };
    </script>
</body>
</html>
